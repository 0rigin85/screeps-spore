module.exports=function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=28)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(31),i=r(32);t.NO_MORE_WORK=123,t.ERR_NO_WORK=-400,t.ERR_CANNOT_PERFORM_TASK=-401,t.ERR_SKIP_WORKER=-402;t.Task=class{constructor(e){this.isComplex=e,this.id="UNKNOWN",this.possibleWorkers=-1,this.priority=50,this.labor=new s.LaborDemand,this.near=null}getSteps(){return[]}createAppointment(e,t){return null}createBasicAppointment(e,t,r){let s=-1,o=0,n=0,l=r;r instanceof RoomPosition||(l=r.pos),null!=l&&(n=-1!=l.x&&-1!=l.y?new RoomPosition(e.pos.x,e.pos.y-1,e.pos.roomName).findDistanceByPathTo(l,{ignoreCreeps:!0}):50*Game.map.getRoomLinearDistance(e.pos.roomName,l.roomName)),n<250&&(s=1-n/250);let a=t.replacingCreep;if(null!=a){let r=e.getBody(t.creepBody),s=0;for(let e of r)e===MOVE&&s++;let i=Math.max(1,(r.length-s)/s);o=Math.ceil(Math.max(0,a.ticksToLive-(n*i+r.length*CREEP_SPAWN_TIME)))}return new i.SpawnAppointment(t.id,t.task,s,e,o,t.replacingCreep,t.creepBody)}shouldPlanToReplace(e){return!0}getBasicPrioritizingConditions(e,t,r){let s=t;t instanceof RoomPosition||null==t||(s=t.pos),e.push(e=>{let t=e.getEfficiencyAs(r);return t<=0?-1:e.type===r.name?.4+.2*t:.2*t}),e.push(e=>{let t=0;return null!=s&&e.pos.roomName==s.roomName?t+=.2:null==e.task&&(t=.1),t}),null!=s&&e.push(e=>300-e.pos.findDistanceByPathTo(s))}getPrioritizingConditions(e){}isIdeal(e){return!1}beginScheduling(){}schedule(e){return t.ERR_NO_WORK}endScheduling(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(7),o=r(14),n=r(16),l=r(0),a=r(33),u=r(9),c=r(34),h=r(5);var p;t.ACTION_TRANSFER="transfer",t.ACTION_RECYCLE="recycle",t.ACTION_COLLECT="collect",t.ACTION_UPGRADE="upgrade",t.ACTION_RESERVE="reserve",t.ACTION_CLAIM="claim",t.ACTION_BUILD="build",t.ACTION_DISMANTLE="dismantle",t.ACTION_REPAIR="repair",t.ACTION_MOVE="move",t.CREEP_TYPE={},(p=new a.BodyDefinition("MINER")).requirements.push(new c.BodyPartRequirements(WORK,5,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,1,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,1,1,1)),t.CREEP_TYPE.MINER=p,(p=new a.BodyDefinition("REMOTE_MINER")).requirements.push(new c.BodyPartRequirements(WORK,6,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,3,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,1,1,1)),t.CREEP_TYPE.REMOTE_MINER=p,(p=new a.BodyDefinition("UPGRADER")).requirements.push(new c.BodyPartRequirements(WORK,15,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,1,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,1,1,1)),t.CREEP_TYPE.UPGRADER=p,(p=new a.BodyDefinition("COURIER")).requirements.push(new c.BodyPartRequirements(MOVE,12,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,12,1,1)),t.CREEP_TYPE.COURIER=p,(p=new a.BodyDefinition("REMOTE_COURIER")).requirements.push(new c.BodyPartRequirements(MOVE,9,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,16,1,1)),p.requirements.push(new c.BodyPartRequirements(WORK,1,1,1)),t.CREEP_TYPE.REMOTE_COURIER=p,(p=new a.BodyDefinition("CITIZEN")).requirements.push(new c.BodyPartRequirements(WORK,5,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,10,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,5,1,1)),t.CREEP_TYPE.CITIZEN=p,(p=new a.BodyDefinition("MASON")).requirements.push(new c.BodyPartRequirements(WORK,3,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,4,1,1)),p.requirements.push(new c.BodyPartRequirements(CARRY,5,1,1)),t.CREEP_TYPE.MASON=p,(p=new a.BodyDefinition("WIRE")).requirements.push(new c.BodyPartRequirements(CARRY,6,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,1,1,1)),t.CREEP_TYPE.WIRE=p,(p=new a.BodyDefinition("RESERVER")).requirements.push(new c.BodyPartRequirements(MOVE,2,1,1)),p.requirements.push(new c.BodyPartRequirements(CLAIM,2,1,1)),t.CREEP_TYPE.RESERVER=p,(p=new a.BodyDefinition("CLAIMER")).requirements.push(new c.BodyPartRequirements(MOVE,1,1,1)),p.requirements.push(new c.BodyPartRequirements(CLAIM,1,1,1)),t.CREEP_TYPE.CLAIMER=p,(p=new a.BodyDefinition("REMOTE_DEFENDER")).requirements.push(new c.BodyPartRequirements(TOUGH,2,1,2)),p.requirements.push(new c.BodyPartRequirements(ATTACK,3,1,1)),p.requirements.push(new c.BodyPartRequirements(RANGED_ATTACK,1,1,1)),p.requirements.push(new c.BodyPartRequirements(MOVE,7,1,1)),p.requirements.push(new c.BodyPartRequirements(HEAL,1,1,1)),t.CREEP_TYPE.REMOTE_DEFENDER=p;class m extends Creep{get carryCount(){return _.sum(this.carry)}get carryCapacityRemaining(){return this.carryCapacity-this.carryCount}get claimReceipt(){if(null!=this._claimReceipt)return this._claimReceipt;let e=this.memory;if(null!=e.claimReceiptTargetId){let t=Game.getObjectById(e.claimReceiptTargetId);null!==t&&(this._claimReceipt=new h.ClaimReceipt(t,e.claimReceiptTargetType,e.claimReceiptResourceType,e.claimReceiptAmount)),null==this._claimReceipt&&(delete e.claimReceiptTargetId,delete e.claimReceiptTargetType,delete e.claimReceiptResourceType,delete e.claimReceiptAmount)}return this._claimReceipt}set claimReceipt(e){this._claimReceipt=e;let t=this.memory;null==e?(delete t.claimReceiptTargetId,delete t.claimReceiptTargetType,delete t.claimReceiptResourceType,delete t.claimReceiptAmount):(t.claimReceiptTargetId=e.target.id,t.claimReceiptTargetType=e.type,t.claimReceiptResourceType=e.resourceType,t.claimReceiptAmount=e.amount)}get cost(){if(null==this.memory.cost){this.memory.cost=0;for(let e of this.body)this.memory.cost+=BODYPART_COST[e.type]}return this.memory.cost}set cost(e){this.memory.cost=e}getEfficiencyAs(e){let t=this.memory;null==t.bodyEfficiency&&(t.bodyEfficiency={});let r=t.bodyEfficiency[e.name];if(null!=r)return r;let s=0,i=0,o=_.groupBy(this.body,function(e){return e.type});for(let r of e.requirements){let n=o[r.type];if(null==n||n.length<r.min)return t.bodyEfficiency[e.name]=0,0;let l=0;for(let e of n)if(e.hits>0&&++l>=r.min)break;if(l<r.min)return t.bodyEfficiency[e.name]=0,0;i+=r.max,s+=Math.min(n.length,r.max)}let n=s/i;return t.bodyEfficiency[e.name]=n,n}get type(){return this.memory.type}get speed(){return this.memory.speed}get spawnRequest(){if(null!=this._spawnRequest)return null!=this._spawnRequest.id?this._spawnRequest:null;let e=this.memory;return this._spawnRequest=new u.SpawnRequest(null,null,null,null),this._spawnRequest.creepBody=m[this.type],null!=e.spawnRequest&&(this._spawnRequest.id=e.spawnRequest.id,null!=e.spawnRequest.taskId&&(this._spawnRequest.task=this.colony.tasksById[e.spawnRequest.taskId]),null!=e.spawnRequest.replacingCreepName&&(this._spawnRequest.replacingCreep=Game.creeps[e.spawnRequest.replacingCreepName])),null!=this._spawnRequest.id?this._spawnRequest:null}set spawnRequest(e){this._spawnRequest=e;let t=this.memory;null==e?delete t.spawnRequest:(t.spawnRequest.id=this._spawnRequest.id,null!=this._spawnRequest.task&&(t.spawnRequest.taskId=this._spawnRequest.task.id),null!=this._spawnRequest.replacingCreep&&(t.spawnRequest.replacingCreepName=this._spawnRequest.replacingCreep.name))}get task(){if(null!=this._task)return this._task;let e=this.memory;return null!=e.taskId&&(this._task=this.colony.tasksById[e.taskId],null==this._task&&(delete e.taskId,this.taskPriority=-1,this.taskMetadata=null)),this._task}set task(e){this._task=e;let t=this.memory;if(null==e)delete t.taskId,this.claimReceipt=null;else{t.taskId=e.id;let r=s.Remember.forTick(`${e.id}.creeps`,()=>[]);_.includes(r,this.id)||r.push(this.id)}}get taskPriority(){if(null!=this._taskPriority)return this._taskPriority;let e=this.memory;return null!=e.taskPriority?this._taskPriority=e.taskPriority:this._taskPriority=-1,this._taskPriority}set taskPriority(e){this._taskPriority=e;let t=this.memory;null==e||e<0?(delete t.taskPriority,this._taskPriority=-1):t.taskPriority=e}get taskMetadata(){if(void 0!==this._taskMetadata)return this._taskMetadata;let e=this.memory;return null!=e.taskMetadata?this._taskMetadata=e.taskMetadata:this._taskMetadata=null,this._taskMetadata}set taskMetadata(e){this._taskMetadata=e;let t=this.memory;null==e?(delete t.taskMetadata,this._taskMetadata=null):t.taskMetadata=e}get action(){if(null!=this._action)return this._action;let e=this.memory;return this._action=e.action,this._action}set action(e){this._action=e;let t=this.memory;null==e?delete t.action:t.action=e}get actionTarget(){if(null!=this._actionTarget)return this._actionTarget;let e=this.memory;return null!=e.actionTargetId&&delete e.actionTargetId,this._actionTarget=e.actionTarget,null==this._actionTarget&&(this._actionTarget="",delete e.actionTarget),this._actionTarget}set actionTarget(e){this._actionTarget=e;let t=this.memory;null==e||0===e.length?delete t.actionTarget:t.actionTarget=e}get movement(){return s.Remember.byName(`creep.${this.id}`,"movement",()=>{let e=this.memory;return null==e.movement&&(e.movement={}),this._movement=new n.SporeCreepMovement(e.movement),this._movement})}goMoveTo(e,r){if(null==e)return l.ERR_NO_WORK;const s=this.movement;if(this.fatigue>0){const r=s.improv.getNextPositions(this.pos,s.pathIndex+1);return this.room.visual.poly(r,{lineStyle:"dashed"}),s.improv.end.roomName==this.room.name&&this.room.visual.text("⚑",s.improv.end),this.action=t.ACTION_MOVE,this.actionTarget=e.toString(),OK}let n=e;if(null!=e.pos&&(n=e.pos),null==n)return l.ERR_NO_WORK;if(null==r&&(r={}),null==r.range&&(r.range=1),null==r.direction&&(r.direction=i.FORWARD),this.pos.inRangeTo(n,r.range))return this.action=t.ACTION_MOVE,this.actionTarget=e.toString(),OK;null!=r.path?s.path=r.path:s.path=null;let a=s.improv;if(null==a&&(a=s.path),null!=a&&!a.leadsTo(n,r.direction,r.range)&&(s.path=null,s.improv=null,null!=r.path))return console.log("ERROR: Attempted to move to '"+e+"' but provided an explicit path to a different location. "),l.ERR_CANNOT_PERFORM_TASK;if(-1===s.pathIndex){if(this.colony.cpuSpentPathing>this.colony.pathingCpuLimit)return this.action=t.ACTION_MOVE,this.actionTarget=e.toString(),OK;if(null!=s.path){let e=s.path.findLastPositionInRoom(this.pos.roomName,r.direction),t=s.path.getPositions(this.pos.roomName),i=new o.SporePathOptions([]),n=4;if(this.speed>=5?(i.plainCost=2,i.swampCost=2,i.costs.push({id:"path",cost:1,targets:t})):this.speed>=1?(i.plainCost=2,i.swampCost=10,n=20,i.costs.push({id:"path",cost:1,targets:t})):(i.plainCost=4,i.swampCost=20,n=40,i.costs.push({id:"path",cost:1,targets:t}),i.costs.push({id:"roads",cost:2})),i.costs.push({id:"nonwalkableStructures",cost:255}),i.costs.push({id:"wires",cost:255}),i.costs.push({id:"allySites",cost:255}),s.improv=this.colony.pathFinder.findPathTo(this.pos,{pos:e,range:0},i),null!=s.improv){let e=s.path.findIntersectionWith(s.improv);null!=e&&(s.improv.setIndexAsDestination(e.otherIndex),s.mergeIndex=e.baseIndex,s.pathIndex=0)}}else{let e=new o.SporePathOptions([]),t=4;this.speed>=5?(e.plainCost=1,e.swampCost=1,t=2):this.speed>=1?t=10:(e.plainCost=2,e.swampCost=10,t=20,e.costs.push({id:"roads",cost:1})),e.costs.push({id:"nonwalkableStructures",cost:255}),e.costs.push({id:"wires",cost:255}),e.costs.push({id:"allySites",cost:255}),s.improv=this.colony.pathFinder.findPathTo(this.pos,{pos:n,range:r.range},e),s.pathIndex=0}this.room.visual.text("👣",this.pos)}else if(null!=s.improv&&s.improv.needsUpdated){let e=new o.SporePathOptions([]),t=4;this.speed>=5?(e.plainCost=1,e.swampCost=1,t=2):this.speed>=1?t=10:(e.plainCost=2,e.swampCost=10,t=20,e.costs.push({id:"roads",cost:1})),e.costs.push({id:"creeps",cost:t}),e.costs.push({id:"nonwalkableStructures",cost:255}),e.costs.push({id:"wires",cost:255}),e.costs.push({id:"allySites",cost:255}),s.improv=this.colony.pathFinder.findPathTo(this.pos,{pos:n,range:r.range},e),s.pathIndex=0,s.improv.needsUpdated=!1,this.room.visual.text("👣",this.pos)}if(null==(a=s.improv)&&(a=s.path),null==a)return l.ERR_NO_WORK;null!=s.expectedPosition&&(s.expectedPosition.isEqualTo(this.pos)?(s.expectedPosition=null,s.pathIndex++,s.failedMoveAttempts=0):(s.expectedPosition=null,s.failedMoveAttempts++));let u={font:.45};if(s.failedMoveAttempts>0)if(1===s.failedMoveAttempts)this.room.visual.text("😒",this.pos.x+.01,this.pos.y+.18,u);else if(2===s.failedMoveAttempts)this.room.visual.text("😒",this.pos.x+.01,this.pos.y+.18,u);else if(3===s.failedMoveAttempts)this.room.visual.text("😣",this.pos.x+.01,this.pos.y+.18,u);else if(4===s.failedMoveAttempts)this.room.visual.text("😠",this.pos.x+.01,this.pos.y+.18,u);else if(s.failedMoveAttempts>=5)return null!=s.path&&(s.path.needsUpdated=!0),null!=s.improv&&(s.improv.needsUpdated=!0),this.room.visual.text("😡",this.pos.x+.01,this.pos.y+.18,u),this.action=t.ACTION_MOVE,this.actionTarget=e.toString(),OK;let c=a.getNextMove(s.pathIndex);if(c<=0){if(!(null!=s.improv&&s.mergeIndex>=0))return null!=s.path&&(s.path.needsUpdated=!0),s.improv=null,console.log("ERROR: Attempted to move to '"+e+"' but encountered an unexpected end to that path. "),l.ERR_CANNOT_PERFORM_TASK;s.improv=null,s.pathIndex=s.mergeIndex,s.mergeIndex=-1}const h=s.improv.getNextPositions(this.pos,s.pathIndex);this.room.visual.poly(h,{lineStyle:"dashed"}),s.improv.end.roomName==this.room.name&&this.room.visual.text("⚑",s.improv.end);let p=this.move(c);return this.doTrack&&console.log(this+" goMoveTo "+p),p==OK?(s.expectedPosition=i.SporePathFinder.getNextPositionByDirection(this.pos,c),this.action=t.ACTION_MOVE,this.actionTarget=e.toString(),OK):(s.expectedPosition=null,console.log("ERROR: Attempted to move to '"+e+"' but encountered unknown error. "+p),l.ERR_CANNOT_PERFORM_TASK)}goHarvest(e,r){if(!e.isValid)return ERR_INVALID_TARGET;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{let i=e.instance.makeClaim(this,RESOURCE_ENERGY,this.carryCapacityRemaining,this.carryCapacityRemaining,!0);if(null==i)return l.ERR_NO_WORK;if(this.claimReceipt=i,(s=i.target.collect(this,i))===OK)return this.action=t.ACTION_COLLECT,this.actionTarget=null!=i?i.target.toString():null,OK;s===ERR_NOT_IN_RANGE&&(s=this.goMoveTo(i.target,r))}return s===OK?OK:s===ERR_NOT_ENOUGH_RESOURCES||s===ERR_INVALID_TARGET?l.ERR_NO_WORK:(console.log("ERROR: Attempted to harvest '"+e+"' but encountered unknown error. "+s),l.ERR_CANNOT_PERFORM_TASK)}goTransfer(e,r,s){if(!r.isValid)return l.ERR_NO_WORK;let i=l.ERR_NO_WORK;if(r.isShrouded)i=this.goMoveTo(r,s);else{if((i=this.transfer(r.instance,e))==OK)return this.action=t.ACTION_TRANSFER,this.actionTarget=r.toString(),OK;if(i==ERR_NOT_IN_RANGE)return this.goMoveTo(r,s)}return this.doTrack&&console.log(this+" goTransfer "+i),i==OK?OK:i==ERR_FULL?l.ERR_NO_WORK:i==ERR_NOT_OWNER?(console.log("ERROR: Attempted to transfer '"+e+"' from another player's creep"),l.ERR_NO_WORK):i==ERR_INVALID_TARGET?(console.log("ERROR: Attempted to transfer '"+e+"' to an invalid target "+r),l.ERR_NO_WORK):i==ERR_BUSY?(console.log("ERROR: Attempted to transfer '"+e+"' to a creep that hasn't spawned yet"),l.ERR_NO_WORK):i==ERR_INVALID_ARGS?(console.log("ERROR: Attempted to transfer an invalid amount of '"+e+"' to a target"),l.ERR_NO_WORK):(console.log("ERROR: Attempted to transfer '"+e+"' to '"+r+"' but encountered unknown error. "+i),l.ERR_CANNOT_PERFORM_TASK)}goBuild(e,r){if(!e.isValid)return l.ERR_NO_WORK;if(0===this.getActiveBodyparts(WORK))return l.ERR_CANNOT_PERFORM_TASK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=this.build(e.instance))===OK)return this.action=t.ACTION_BUILD,this.actionTarget=e.toString(),OK;s===ERR_NOT_IN_RANGE&&(s=this.goMoveTo(e,r))}return s===OK?OK:s==ERR_NOT_ENOUGH_RESOURCES||s==ERR_INVALID_TARGET||s==ERR_RCL_NOT_ENOUGH?l.ERR_NO_WORK:l.ERR_CANNOT_PERFORM_TASK}goDismantle(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=this.getActiveBodyparts(WORK)>0,i=this.getActiveBodyparts(ATTACK)>0,o=this.getActiveBodyparts(RANGED_ATTACK)>0;if(!i&&!s&&!o)return l.ERR_CANNOT_PERFORM_TASK;let n=l.ERR_NO_WORK;if(e.isShrouded)n=this.goMoveTo(e,r);else{if(e.instance.notifyWhenAttacked(!1),s)n=this.dismantle(e.instance);else if(i)n=this.attack(e.instance);else{if(!o)return l.ERR_CANNOT_PERFORM_TASK;n=this.rangedAttack(e.instance)}if(n===OK)return this.action=t.ACTION_DISMANTLE,this.actionTarget=e.toString(),OK;n===ERR_NOT_IN_RANGE&&(n=this.goMoveTo(e,r),o&&this.rangedAttack(e.instance))}return n===OK?OK:n==ERR_INVALID_TARGET?l.ERR_NO_WORK:l.ERR_CANNOT_PERFORM_TASK}goRepair(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=this.repair(e.instance))===OK)return this.action=t.ACTION_REPAIR,this.actionTarget=e.toString(),OK;if(s===ERR_NOT_IN_RANGE)return this.goMoveTo(e,r)}return s===OK?OK:s===ERR_INVALID_TARGET?l.ERR_NO_WORK:(console.log("Creep "+this.name+" goRepair error code: "+s),l.ERR_CANNOT_PERFORM_TASK)}goCollect(e,r,s,i,o,n,a,u){this.action!=t.ACTION_COLLECT&&this.action!=t.ACTION_MOVE&&(this.claimReceipt=null);let c=this.colony.claimResource(this,e,r,s,i,o,n,a,this.claimReceipt);if(null==c)return l.ERR_NO_WORK;this.claimReceipt=c;let h=c.target.collect(this,c);return h===OK?(this.action=t.ACTION_COLLECT,this.actionTarget=c.target.toString(),OK):(h===ERR_NOT_IN_RANGE&&(h=this.goMoveTo(c.target,u)),h===OK?OK:(this.claimReceipt=null,h===ERR_NOT_ENOUGH_RESOURCES?(console.log("FAILED TO CONFIRM AVAILABLE RESOURCES BEFORE COLLECTING. "+this+" "+c.target+" "+c.amount+" "+c.resourceType),l.ERR_NO_WORK):l.ERR_CANNOT_PERFORM_TASK))}goUpgrade(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=this.upgradeController(e.instance))===OK)return this.action=t.ACTION_UPGRADE,this.actionTarget=e.toString(),this.claimReceipt=null,OK;if(s===ERR_NOT_IN_RANGE)return this.goMoveTo(e,r)}return s===OK?OK:(console.log("goUpgrade error code: "+s+" "+this),l.ERR_CANNOT_PERFORM_TASK)}goReserve(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=this.reserveController(e.instance))===OK)return this.action=t.ACTION_RESERVE,this.actionTarget=e.toString(),this.claimReceipt=null,OK;if(s===ERR_NOT_IN_RANGE)return this.goMoveTo(e,r)}return s===OK?OK:(console.log("goReserve error code: "+s+" "+this),l.ERR_CANNOT_PERFORM_TASK)}goClaim(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=this.claimController(e.instance))===OK)return this.action=t.ACTION_CLAIM,this.actionTarget=e.toString(),this.claimReceipt=null,OK;if(s===ERR_NOT_IN_RANGE)return this.goMoveTo(e,r)}return s===OK?OK:(console.log("goClaim error code: "+s+" "+this),l.ERR_CANNOT_PERFORM_TASK)}goRecycle(e,r){if(!e.isValid)return l.ERR_NO_WORK;let s=l.ERR_NO_WORK;if(e.isShrouded)s=this.goMoveTo(e,r);else{if((s=e.instance.recycleCreep(this))===OK)return this.action=t.ACTION_RECYCLE,this.actionTarget=e.toString(),this.claimReceipt=null,OK;if(s===ERR_NOT_IN_RANGE)return this.goMoveTo(e,r)}return s===OK?OK:(console.log("goRecycle error code: "+s),l.ERR_CANNOT_PERFORM_TASK)}}t.SporeCreep=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static byName(e,t,r,i){return null==this.groupData[e]&&(this.groupData[e]={}),s.getData(this.groupData[e],t,r,i)}static forTick(e,t,r){return s.getData(s.tickData,e,t,r)}static lastTick(e){return null==Memory.previousTick?null:s.getData(Memory.previousTick,e,null,null)}static forever(e,t,r){return s.getData(Memory,e,t,r)}static beginTick(){this.tickData={},this.groupData={}}static endTick(){Memory.previousTick=this.tickData}static getData(e,t,r,s){let i=t.split("."),o=i.length;for(let t=0;t<o-1;t++){let r=i[t];e=e[r]||(e[r]={})}return null!=r?e=s?e[i[o-1]]=r():e[i[o-1]]||(e[i[o-1]]=r()):null!=e&&(e=e[i[o-1]]),e}}s.tickData={},s.groupData={},t.Remember=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.toString=()=>{let e="",t="";return null!=this.lookType&&(e=null!=this.lookTypeModifier?`${this.lookType} (${this.lookTypeModifier})`:`${this.lookType}`),null!=this.pos&&this.lookType!==LOOK_FLAGS&&(t=` {room ${this.pos.roomName} pos ${this.pos.x}, ${this.pos.y} }`),`[${e}${t}]`},this.toHtml=()=>`<font color='#ff4500'>[${this.toString()}]</font>`}get room(){return this.resolve().isValid?this.cache.instance.room:null}get isValid(){return this.resolve().isValid}get isShrouded(){return this.resolve(),this.cache.isValid&&null==this.cache.instance}get instance(){return this.resolve().instance}resolve(){if(null!=this.cache)return this.cache;if(this.cache={instance:null,isValid:!0},null!=this.id){if(this.cache.instance=Game.getObjectById(this.id),null!=this.cache.instance)return this.cache;if(null==this.pos||null!=Game.rooms[this.pos.roomName])return this.cache.isValid=!1,this.cache}if(this.lookType===LOOK_FLAGS)this.cache.instance=Game.flags[this.lookTypeModifier],null==this.cache.instance&&(this.cache.isValid=!1);else if(null!=this.pos){if(null!=Game.rooms[this.pos.roomName]){let e=Game.rooms[this.pos.roomName];if(null==this.lookTypeModifier){let t=e.lookForAt(this.lookType,this.pos);1==t.length?this.cache.instance=t[0]:this.cache.isValid=!1}else if(this.lookType==LOOK_STRUCTURES||this.lookType==LOOK_CONSTRUCTION_SITES){let t=e.lookForAt(this.lookType,this.pos);this.cache.instance=_.find(t,function(e){return e.structureType===this.lookTypeModifier}.bind(this)),null==this.cache.instance&&(this.cache.isValid=!1)}}}else this.cache.isValid=!1;return this.cache}static fromPosition(e,t,r){let i=new s;return i.pos=e,i.lookType=t,i.lookTypeModifier=r,i}static from(e){let t=new s;return t.id=e.id,t.pos=e.pos,t.cache={instance:e,isValid:!0},e instanceof Creep?t.lookType=LOOK_CREEPS:e instanceof Resource?t.lookType=LOOK_RESOURCES:e instanceof Source?t.lookType=LOOK_SOURCES:e instanceof Structure?(t.lookType=LOOK_STRUCTURES,t.lookTypeModifier=e.structureType):e instanceof Flag?(t.lookType=LOOK_FLAGS,t.lookTypeModifier=e.name):e instanceof ConstructionSite&&(t.lookType=LOOK_CONSTRUCTION_SITES,t.lookTypeModifier=e.structureType),t}}t.Ptr=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LaborDemandType=class{constructor(e,t,r){this.parts=e,this.min=t,this.max=r;for(let t in BODYPART_COST)null==e[t]&&(e[t]=0)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ClaimReceipt=class{constructor(e,t,r,s){this.target=e,this.type=t,this.resourceType=r,this.amount=s}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CollectOptions=class{constructor(e,t){this.roomNames=e,this.storePriorities=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(13),i=r(14),o=r(15);t.NON_WALKABLE=255,t.FORWARD=1,t.REVERSE=-1,t.DIRECTION_OFFSETS=[],t.DIRECTION_OFFSETS.push({x:0,y:0}),t.DIRECTION_OFFSETS.push({x:0,y:-1}),t.DIRECTION_OFFSETS.push({x:1,y:-1}),t.DIRECTION_OFFSETS.push({x:1,y:0}),t.DIRECTION_OFFSETS.push({x:1,y:1}),t.DIRECTION_OFFSETS.push({x:0,y:1}),t.DIRECTION_OFFSETS.push({x:-1,y:1}),t.DIRECTION_OFFSETS.push({x:-1,y:0}),t.DIRECTION_OFFSETS.push({x:-1,y:-1}),t.OFFSETS_DIRECTION=[],t.OFFSETS_DIRECTION.push([]),t.OFFSETS_DIRECTION[0].push(TOP_LEFT),t.OFFSETS_DIRECTION[0].push(LEFT),t.OFFSETS_DIRECTION[0].push(BOTTOM_LEFT),t.OFFSETS_DIRECTION.push([]),t.OFFSETS_DIRECTION[1].push(TOP),t.OFFSETS_DIRECTION[1].push(0),t.OFFSETS_DIRECTION[1].push(BOTTOM),t.OFFSETS_DIRECTION.push([]),t.OFFSETS_DIRECTION[2].push(TOP_RIGHT),t.OFFSETS_DIRECTION[2].push(RIGHT),t.OFFSETS_DIRECTION[2].push(BOTTOM_RIGHT);class n{constructor(e){this.memory=e,null==e.rooms&&this._cacheRoomBoundaries()}get ops(){return this.memory.ops}get cost(){return this.memory.cost}get incomplete(){return!0===this.memory.incomplete}get needsUpdated(){return this.memory.needsUpdated}set needsUpdated(e){this.memory.needsUpdated=e}get start(){return null!=this._start?this._start:(this._start=o.SporeRoomPosition.deserialize(this.memory.start),this._start)}get end(){return null!=this._end?this._end:(this._end=o.SporeRoomPosition.deserialize(this.memory.end),this._end)}getNextMove(e){return e>=0&&e<this.memory.directions.length?+this.memory.directions[e]:0}getNextPositions(e,t,r){let s=[],i=r||this.memory.directions.length;i>this.memory.directions.length&&(i=this.memory.directions.length);let o=e;s.push(o);for(let r=t;r<i;++r){let t=+this.memory.directions[r];if((o=l.getNextPositionByDirection(o,t)).roomName!==e.roomName)break;s.push(o)}return s}getPositions(e){if(null!=this._positions)return _.filter(this._positions,{roomName:e});if(null==this.memory.rooms[e])return[];let t=[],r=o.SporeRoomPosition.deserialize(this.memory.rooms[e].entrance),s=this.memory.rooms[e].entranceIndex;for(;s<this.memory.directions.length;++s){t.push(r);let e=+this.memory.directions[s];r=l.getNextPositionByDirection(r,e)}return t.push(r),t}findLastPositionInRoom(e,r){return r===t.FORWARD?null==this.memory.rooms[e].exit?this.end.roomName===e?this.end:null:o.SporeRoomPosition.deserialize(this.memory.rooms[e].exit):r===t.REVERSE?null==this.memory.rooms[e].entrance?this.start.roomName===e?this.start:null:o.SporeRoomPosition.deserialize(this.memory.rooms[e].entrance):null}getSubPath(e){let t=this.memory.rooms[e].entranceIndex,r=this.memory.rooms[e].entrance;null==r&&(t=0,r=this.memory.start);let s=this.memory.rooms[e].exitIndex,i=this.memory.rooms[e].exit;null==i&&(s=this.memory.directions.length,i=this.memory.end);let o=this.memory.directions.substring(t,s);return new n({ops:-1,cost:-1,start:r,end:i,directions:o,rooms:{},tickCalculated:this.memory.tickCalculated,tickLifespan:this.memory.tickLifespan,needsUpdated:!1})}findIntersectionWith(e){let t=e.start;for(let r=0;r<e.memory.directions.length;++r){let e=+this.memory.directions[r];t=l.getNextPositionByDirection(t,e);let s=this._getIndexOnPath(t);if(s>=0)return{baseIndex:s,otherIndex:r}}return null}_getIndexOnPath(e){if(null==this._positionsMap){this._positionsMap={};let e=this.start;for(let t=0;t<this.memory.directions.length;++t){this._cachePositionToMap(e,t);let r=+this.memory.directions[t];e=l.getNextPositionByDirection(e,r)}this._cachePositionToMap(e,this.memory.directions.length)}let t=this._positionsMap[e.x];return null==t?-1:null==(t=t[e.y])?-1:null==(t=t[e.roomName])?-1:t}_cachePositionToMap(e,t){let r=this._positionsMap[e.x];if(null==r){let r={};r[e.roomName]=t,this._positionsMap[e.x]={[e.y]:r}}let s=r[e.y];if(null==s){let s={};s[e.roomName]=t,r[e.y]=s}null==s[e.roomName]&&(s[e.roomName]=t)}_cacheRoomBoundaries(){this.memory.rooms={};let e=this.start;for(let t=0;t<this.memory.directions.length;++t){0!==e.x&&50!==e.x&&0!==e.y&&50!==e.y||(null==this.memory.rooms[e.roomName]&&(this.memory.rooms[e.roomName]={}),null==this.memory.rooms[e.roomName].entrance?(this.memory.rooms[e.roomName].entrance=o.SporeRoomPosition.serialize(e),this.memory.rooms[e.roomName].entranceIndex=t):null==this.memory.rooms[e.roomName].exit?(this.memory.rooms[e.roomName].exit=o.SporeRoomPosition.serialize(e),this.memory.rooms[e.roomName].exitIndex=t):console.log("_//////////////////////////////// ERROR CACHING ROOM BOUNDARIES"));let r=+this.memory.directions[t];e=l.getNextPositionByDirection(e,r)}}setIndexAsDestination(e){this.memory.directions=this.memory.directions.substr(0,e);let t=this.start;for(let e=0;e<this.memory.directions.length;++e){this._cachePositionToMap(t,e);let r=+this.memory.directions[e];t=l.getNextPositionByDirection(t,r)}}leadsTo(e,r,s){return r===t.FORWARD?!!this.end.isEqualTo(e)||this.end.inRangeTo(e,s):r===t.REVERSE&&(!!this.start.isEqualTo(e)||this.start.inRangeTo(e,s))}isEqualTo(e){return!(this.memory.start!==e.memory.start||this.memory.end!==e.memory.end||this.memory.directions!==e.memory.directions)}serialize(){return this.memory}}t.SporePath=n;class l{constructor(){this._costMatrixCache=new s.SporeCostMatrixCache,this._pathCache={};let e=Memory.paths;null==e&&(Memory.paths={},e=Memory.paths);let t=Object.keys(e);for(let r in t){let t=e[r];t.tickLifespan>=Game.time-t.tickCalculated?this._pathCache[r]=t:delete e[r]}}static serializeDirections(e,r){if(null==r||0===r.length)return"";let s="";s+=t.OFFSETS_DIRECTION[r[0].x-e.x+1][r[0].y-e.y+1];let i=!1;for(let t=0;t<r.length;++t)if(r[t].roomName!==e.roomName){i=!0;break}for(let e=1;e<r.length;++e){let i=e-1;(r[i].x>=49||r[i].x<=0||r[i].y>=49||r[i].y<=0)&&(r[e].x>=49||r[e].x<=0||r[e].y>=49||r[e].y<=0)||(s+=t.OFFSETS_DIRECTION[Math.min(Math.max(r[e].x-r[i].x,-1),1)+1][Math.min(Math.max(r[e].y-r[i].y,-1),1)+1])}return s}static deserializeDirections(e,t){let r=[];if(null==e||0===e.length)return r;let s=t;r.push(s);for(let t=0;t<e.length;++t){let i=+e[t];s=l.getNextPositionByDirection(s,i),r.push(s)}return r}static getNextPositionByDirection(e,r){if(null==e)return null;let s=!1,i=t.DIRECTION_OFFSETS[r],o=0,n=0,l=e.x+i.x,a=e.y+i.y,u=e.roomName;if(l>=49?(l=0,++o,s=!0):l<=0&&(l=49,--o,s=!0),a>=49?(a=0,++n,s=!0):a<=0&&(a=49,--n,s=!0),s){let t=e.roomName[0],r=e.roomName.indexOf("N");-1===r&&(r=e.roomName.indexOf("S"));let s=e.roomName[r],i=+e.roomName.substring(1,r),l=+e.roomName.substring(r+1,e.roomName.length);i<0&&(t="E"===t?"W":"E"),l<0&&(s="N"===s?"S":"N"),u=t+(i+o)+s+(l+n)}return new RoomPosition(l,a,u)}findPathTo(e,t,r){null==r&&(r=i.SporePathOptions.Default);let s;r.persist;if(null!=s)return s;let o=PathFinder.search(e,t,{plainCost:r.plainCost,swampCost:r.swampCost,roomCallback:function(e){return this._costMatrixCache.findCostMatrix(e,r.costs)}.bind(this)});if(null==o.path||0===o.path.length)return null;let a={ops:o.ops,cost:o.cost,incomplete:o.incomplete,start:e.serialize(),end:o.path[o.path.length-1].serialize(),directions:l.serializeDirections(e,o.path),rooms:null,tickCalculated:Game.time,tickLifespan:0,needsUpdated:!1};return(s=new n(a))._positions=o.path,s}}t.SporePathFinder=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1);t.TransferResource=class extends s.Task{constructor(e,t,r,s){if(super(!1),this.targets=e,this.resourceType=t,this.source=r,this.options=s,this.scheduledTransfer=0,this.scheduledWorkers=0,this.scheduledCarry=0,this.reserveWorkers=!1,this.capacityCap=2e3,this.idealCreepBody=o.CREEP_TYPE.COURIER,this.resourcesNeeded=-1,this.needsResources=[],this.resourceCapacity=-1,this.id=`Transfer:${t} ${e.map(function(e){return e.id}).join(",")}`,null!=r)this.id+=" "+r,this.roomName=r.pos.roomName;else{this.id+=" ";for(let e=0;e<s.storePriorities.length;e++)this.id+=s.storePriorities[e].join(",");this.roomName=e[0].pos.roomName}this.name=`Transfer ${t} to ${e.length} objects`,this.near=r}calculateRequirements(){this.needsResources.length=0,this.resourcesNeeded=-1,this.resourceCapacity=-1;for(let e=0;e<this.targets.length;e++){let t=this.targets[e];if(t.isValid)if(t.isShrouded)this.needsResources.push(this.targets[e]);else if(null!=t.instance.energyCapacity&&this.resourceType===RESOURCE_ENERGY){let e=t.instance,r=e.energyCapacityRemaining;this.resourceCapacity+=e.energyCapacity,r>0&&(this.needsResources.push(t),this.resourcesNeeded+=r)}else if(null!=t.instance.storeCapacity){let e=t.instance,r=e.storeCapacityRemaining;e instanceof StructureStorage?this.resourceCapacity+=3e5:this.resourceCapacity+=r+e.store[this.resourceType],r>0&&(this.needsResources.push(t),this.resourcesNeeded+=r)}else if(null!=t.instance.carryCapacity){let e=t.instance,r=e.carryCapacityRemaining;this.resourceCapacity+=r+e.carry[this.resourceType],r>0&&(this.needsResources.push(t),this.resourcesNeeded+=r)}else console.log("UNKNOWN TransferResource Target Type")}}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):null!=this.source?super.createBasicAppointment(e,t,this.source):super.createBasicAppointment(e,t,this.targets[0])}getPrioritizingConditions(e){e.push(e=>0===e.carry[this.resourceType]&&e.carryCount===e.carryCapacity?-1:e.type===o.CREEP_TYPE.UPGRADER.name?-1:0),super.getBasicPrioritizingConditions(e,this.source,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.calculateRequirements();let e=null;e=null!=this.source?this.source.room:this.targets[0].room,this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({carry:Math.floor(Math.min(this.resourceCapacity,this.capacityCap)/CARRY_CAPACITY*.8)},1,3),this.scheduledTransfer=0,this.scheduledWorkers=0,this.scheduledCarry=0}hasWork(){return!(0===this.possibleWorkers||this.resourcesNeeded<=0||null!=this.labor.types[this.idealCreepBody.name]&&(this.scheduledCarry>=this.labor.types[this.idealCreepBody.name].parts[CARRY]||this.scheduledWorkers>=this.labor.types[this.idealCreepBody.name].max))}schedule(e){let t=null;if(t=null!=this.source?this.source.room:this.targets[0].room,!(e instanceof Creep))return console.log("ERROR: Attempted to transfer resources with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let r=e;if(null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep)return r.goMoveTo(r.spawnRequest.replacingCreep),OK;if(!this.hasWork())return s.ERR_NO_WORK;if(this.scheduledTransfer>0&&(r.type===o.CREEP_TYPE.MINER.name||r.type===o.CREEP_TYPE.UPGRADER.name))return s.ERR_SKIP_WORKER;let i,n=Math.max(0,this.resourcesNeeded-this.scheduledTransfer);if(this.resourcesNeeded<=0)r.carryCount<r.carryCapacity?i=this.scheduleCollect(r,r.carryCapacityRemaining,this.needsResources):(i=this.scheduleTransfer(r,this.needsResources))===s.ERR_NO_WORK&&(i=r.goMoveTo(this.targets[0]));else if(r.action===o.ACTION_COLLECT&&r.carryCount<r.carryCapacity)(i=this.scheduleCollect(r,n,this.needsResources))===s.ERR_NO_WORK&&r.carry[this.resourceType]>0&&(i=this.scheduleTransfer(r,this.needsResources));else if(r.carry[this.resourceType]>0)if(r.carryCount===r.carryCapacity||r.carry[this.resourceType]>=n||(r.action===o.ACTION_TRANSFER||r.action===o.ACTION_MOVE)&&r.carry[this.resourceType]>0)i=this.scheduleTransfer(r,this.needsResources);else{let e=r.pos.findFirstInRange(this.needsResources,4);i=null!=e?r.goTransfer(this.resourceType,e):this.scheduleCollect(r,n,this.needsResources)}else i=this.scheduleCollect(r,n,this.needsResources);if(this.reserveWorkers&&r.type===this.idealCreepBody.name&&(i=OK),i===OK&&null==r.spawnRequest){let e=r.carryCapacityRemaining+r.carry[this.resourceType];this.scheduledTransfer+=e,this.scheduledWorkers++,this.scheduledCarry+=Math.floor(e/CARRY_CAPACITY),this.possibleWorkers>0&&this.possibleWorkers--}return 0!==this.possibleWorkers&&this.hasWork()?i:s.NO_MORE_WORK}scheduleTransfer(e,t){let r=s.ERR_NO_WORK,i=e.pos.findClosestByRange(t);return null!=i?r=e.goTransfer(this.resourceType,i):t.length>0?r=e.goTransfer(this.resourceType,t[0]):this.targets.length>0&&(r=e.goTransfer(this.resourceType,this.targets[0])),r}scheduleCollect(e,t,r){let i;if(null!=this.source)i=e.goHarvest(this.source);else{let o=Math.min(e.carryCapacityRemaining,t);(i=e.goCollect(this.resourceType,o,o,!1,r.length>0?r[0].pos:e.pos,this.options,_.indexBy(this.targets,"id")))===s.ERR_NO_WORK&&(i=e.carry[this.resourceType]>0?this.scheduleTransfer(e,r):e.goCollect(this.resourceType,o,0,!1,r.length>0?r[0].pos:e.pos,this.options,_.indexBy(this.targets,"id")))}return i}endScheduling(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SpawnRequest=class{constructor(e,t,r,s){this.id=e,this.task=t,this.replacingCreep=r,this.creepBody=s}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1),n=r(6);let l={spawn:function(e){return 1e3},tower:function(e){return 1e3},extension:function(e){return 100},container:function(e){return 100},link:function(e){return 100},extractor:function(e){return 100},lab:function(e){return 75},storage:function(e){return 100},terminal:function(e){return 75},rampart:function(e){return 25},road:function(e){return 75},constructedWall:function(e){return 25},observer:function(e){return 25},powerSpawn:function(e){return 25},nuker:function(e){return 25}};t.BuildStructure=class extends s.Task{constructor(e){super(!1),this.site=e,this.id="Build [structure ("+e.lookTypeModifier+") {room "+this.site.pos.roomName+"}]",this.name="Build "+e.toHtml(),this.possibleWorkers=-1,this.priority=l[e.lookTypeModifier](e),this.idealCreepBody=o.CREEP_TYPE.CITIZEN,this.scheduledWork=0,this.desiredWork=5,this.near=e,this.roomName=this.site.pos.roomName,this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({},1,2)}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,this.site)}getPrioritizingConditions(e){e.push(e=>0===e.carry[RESOURCE_ENERGY]&&e.carryCount===e.carryCapacity?-1:e.type===o.CREEP_TYPE.MINER.name||e.type===o.CREEP_TYPE.UPGRADER.name?-1:0),super.getBasicPrioritizingConditions(e,this.site,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWork=0}schedule(e){if(0===this.possibleWorkers||!this.site.isValid||this.scheduledWork>=this.desiredWork)return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to build a structure with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep)return r.goMoveTo(r.spawnRequest.replacingCreep),OK;if(r.carry[RESOURCE_ENERGY]===r.carryCapacity||(r.action===o.ACTION_BUILD||r.action===o.ACTION_MOVE)&&r.carry[RESOURCE_ENERGY]>0)t=r.goBuild(this.site);else{let e=r.carryCapacityRemaining;this.site.isShrouded||Math.min(r.carryCapacityRemaining,this.site.instance.progressRemaining),t=r.goCollect(RESOURCE_ENERGY,e,e,!1,this.site.pos,new n.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]]),{})}return t===OK&&(this.scheduledWork+=r.getActiveBodyparts(WORK),this.possibleWorkers>0&&this.possibleWorkers--),0===this.possibleWorkers||this.scheduledWork>=this.desiredWork?s.NO_MORE_WORK:t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1);t.DismantleStructure=class extends s.Task{constructor(e){super(!1),this.structure=e,this.id="Dismantle "+this.structure,this.name="Dismantle "+this.structure,this.idealCreepBody=i.CREEP_TYPE.CITIZEN,this.near=e}getPrioritizingConditions(e){super.getBasicPrioritizingConditions(e,this.structure,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWork=0,this.scheduledWorkers=0}schedule(e){if(!(0!==this.possibleWorkers&&this.structure.isValid&&e instanceof Creep))return s.ERR_NO_WORK;let t=e;if(t.type===i.CREEP_TYPE.MINER.name&&this.scheduledWorkers>0)return s.ERR_CANNOT_PERFORM_TASK;if(null!=t.spawnRequest&&null!=t.spawnRequest.replacingCreep)return t.goMoveTo(t.spawnRequest.replacingCreep),OK;let r=t.goDismantle(this.structure);return r===OK&&(this.scheduledWorkers++,this.scheduledWork+=t.getActiveBodyparts(WORK),this.possibleWorkers>0&&this.possibleWorkers--),r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(1),o=r(6),n=r(2),l=r(35),a=r(36),u=r(17),c=r(8),h=r(19),p=r(20),m=r(21),d=r(22),R=["pcake0rigin","barney","pcakecysote","swifty","yeurch","0xdeadfeed"],y=["barney","pcakecysote","swifty","yeurch","0xdeadfeed"];let g={};g[STRUCTURE_CONTAINER]={ideal:CONTAINER_HITS,regular:{threshold:2e5,priority:100},dire:{threshold:1e5,priority:1e3}},g[STRUCTURE_TOWER]={ideal:TOWER_HITS,regular:{threshold:2e3,priority:100},dire:{threshold:1e3,priority:1e3}},g[STRUCTURE_ROAD]={ideal:ROAD_HITS,regular:{threshold:2500,priority:100},dire:{threshold:500,priority:50}},g[STRUCTURE_RAMPART]={ideal:2e4,regular:{threshold:15e3,priority:100},dire:{threshold:1e4,priority:50}},g[STRUCTURE_WALL]={ideal:2e4,regular:{threshold:2e4,priority:50},dire:{threshold:1e4,priority:25}},g[STRUCTURE_LINK]={ideal:LINK_HITS_MAX,regular:{threshold:.8*LINK_HITS_MAX,priority:100},dire:{threshold:.3*LINK_HITS_MAX,priority:1e3}};class f extends Room{get budget(){null==Memory.rooms&&(Memory.rooms={});let e=Memory.rooms[this.name];return null==e&&(e={},Memory.rooms[this.name]=e),null==e.budget&&(e.budget=new a.Budget),e.budget}get my(){return null!=this.controller&&(this.controller.my||null!=this.controller.reservation&&"PCake0rigin"==this.controller.reservation.username)}get isReserved(){let e=!1;return null!=this.controller&&null!=this.controller.reservation&&(e="PCake0rigin"==this.controller.reservation.username),e}static getPriority(e){let t=Memory.rooms[e];return null==t&&(t={},Memory.rooms[e]=t),null==t.priority&&(t.priority=100),null!=Game.rooms[e]&&Game.rooms[e].my&&t.priority<=100&&(t.priority=500),t.priority}get priority(){return f.getPriority(this.name)}get energyHarvestedSinceLastInvasion(){let e=Memory.rooms[this.name];return null==e&&(e={},Memory.rooms[this.name]=e),null==e.energyHarvestedSinceLastInvasion&&(e.energyHarvestedSinceLastInvasion=3e5),e.energyHarvestedSinceLastInvasion}set energyHarvestedSinceLastInvasion(e){let t=Memory.rooms[this.name];null==t&&(t={},Memory.rooms[this.name]=t),t.energyHarvestedSinceLastInvasion=e}get sources(){return n.Remember.byName(`room.${this.name}`,"sources",function(){let e,t=Memory.rooms[this.name];null==t&&(t={},Memory.rooms[this.name]=t);let r=t.sources;if(null==r)t.sources={},e=this.find(FIND_SOURCES),_.forEach(e,function(e){t.sources[e.id]={}});else{e=[];for(let t in r){let r=Game.getObjectById(t);null!=r&&e.push(r)}}return e}.bind(this))}get extractor(){return n.Remember.byName(`room.${this.name}`,"extractor",function(){let e=this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_EXTRACTOR}}),t=null;return null!=e&&e.length>0&&(t=e[0]),t}.bind(this))}get mySpawns(){return this.find(FIND_MY_SPAWNS)}get structures(){return this.find(FIND_STRUCTURES)}get nonwalkableStructures(){return n.Remember.byName(`room.${this.name}`,"nonwalkableStructures",function(){return _.filter(this.structures,function(e){return _.includes(OBSTACLE_OBJECT_TYPES,e.structureType)}.bind(this))}.bind(this))}get roads(){return n.Remember.byName(`room.${this.name}`,"roads",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_ROAD}})}.bind(this))}get extensions(){return n.Remember.byName(`room.${this.name}`,"extensions",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_EXTENSION}})}.bind(this))}get containers(){return n.Remember.byName(`room.${this.name}`,"containers",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_CONTAINER}})}.bind(this))}get ramparts(){return n.Remember.byName(`room.${this.name}`,"ramparts",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_RAMPART}})}.bind(this))}get towers(){return n.Remember.byName(`room.${this.name}`,"towers",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_TOWER}})}.bind(this))}get links(){return n.Remember.byName(`room.${this.name}`,"links",function(){return this.find(FIND_STRUCTURES,{filter:{structureType:STRUCTURE_LINK}})}.bind(this))}get resources(){return this.find(FIND_DROPPED_RESOURCES)}get constructionSites(){return this.find(FIND_CONSTRUCTION_SITES)}get allySites(){return n.Remember.byName(`room.${this.name}`,"allySites",function(){return this.find(FIND_CONSTRUCTION_SITES,{filter:function(e){return y.indexOf(e.owner.username.toLowerCase())>-1}.bind(this)})}.bind(this))}get creeps(){return this.find(FIND_CREEPS)}get myCreeps(){return this.find(FIND_MY_CREEPS)}get wires(){return this.find(FIND_FLAGS,{filter:function(e){return e.color===COLOR_WHITE}.bind(this)})}get hostileCreeps(){return n.Remember.byName(`room.${this.name}`,"hostileCreeps",function(){return this.find(FIND_HOSTILE_CREEPS,{filter:function(e){return-1===R.indexOf(e.owner.username.toLowerCase())}.bind(this)})}.bind(this))}get friendlyCreeps(){return n.Remember.byName(`room.${this.name}`,"friendlyCreeps",function(){return this.find(FIND_HOSTILE_CREEPS,{filter:function(e){return R.indexOf(e.owner.username.toLowerCase())>-1}.bind(this)})}.bind(this))}get injuredFriendlyCreeps(){return n.Remember.byName(`room.${this.name}`,"injuredFriendlyCreeps",function(){return this.find(FIND_CREEPS,{filter:function(e){return e.hits<e.hitsMax&&R.indexOf(e.owner.username.toLowerCase())>-1}.bind(this)})}.bind(this))}get sourceKeepers(){return n.Remember.byName(`room.${this.name}`,"sourceKeepers",function(){return this.find(FIND_CREEPS,{filter:function(e){return"Source Keeper"===e.owner.username}.bind(this)})}.bind(this))}get invaders(){return n.Remember.byName(`room.${this.name}`,"invaders",function(){return this.find(FIND_CREEPS,{filter:function(e){return"Invader"===e.owner.username}.bind(this)})}.bind(this))}lookForByRadiusAt(e,t,r,s){let i=t;return null!=t.pos&&(i=t.pos),s?this.lookForAtArea(e,Math.max(i.y-r,0),Math.max(i.x-r,0),Math.min(i.y+r,49),Math.min(i.x+r,49),!0):this.lookForAtArea(e,Math.max(i.y-r,0),Math.max(i.x-r,0),Math.min(i.y+r,49),Math.min(i.x+r,49),!1)}trackEconomy(){this.economy=new l.Economy,null==this.budget.savings[RESOURCE_ENERGY]&&(this.budget.savings[RESOURCE_ENERGY]=1e5);for(let e of this.containers)e.structureType===STRUCTURE_CONTAINER&&this.economy.countStoreResources(e.store);for(let e of this.links)e.structureType===STRUCTURE_LINK&&(this.economy.resources[RESOURCE_ENERGY]+=e.energy);if(null!=this.storage)for(let e in this.storage.store){null==this.economy.resources[e]&&(this.economy.resources[e]=0);let t=0;null!=this.budget.savings[e]&&this.budget.savings[e]>0&&(t=this.budget.savings[e]),this.economy.resources[e]+=Math.max(this.storage.store[e]-t,0)}for(let e of this.resources)this.economy.resources[e.resourceType]+=e.amount;for(let e of this.myCreeps)this.economy.demand[RESOURCE_ENERGY]+=e.cost;console.log(this+" economy energy supply "+this.economy.resources.energy),console.log(this+" economy energy demand "+Math.ceil(this.economy.demand.energy/1500))}getTasks(){let e=[];if(this.controller.safeModeAvailable>0&&null==this.controller.safeMode&&this.hostileCreeps.length>0){let e=_.filter(this.structures,function(e){return!(e.structureType===STRUCTURE_RAMPART||e.structureType===STRUCTURE_WALL||e.structureType===STRUCTURE_CONTAINER||e.structureType===STRUCTURE_LINK||e.structureType===STRUCTURE_ROAD)});for(let t of this.hostileCreeps)t.pos.findFirstInRange(e,2)&&this.controller.activateSafeMode()}for(let t of this.sources){if(t.doIgnore)continue;let r=new u.HarvestEnergy(s.Ptr.from(t));r.priority=1025+t.priorityModifier,this.isReserved&&(r.idealCreepBody=i.CREEP_TYPE.REMOTE_MINER),e.push(r)}if(this.isReserved){let t=[],r=Game.getObjectById("5d0ae2635bf1730d8cfefd35");null!=r?t.push(s.Ptr.from(r)):t.push(s.Ptr.from(Game.rooms.E51S39.storage));let n=new c.TransferResource(t,RESOURCE_ENERGY,null,new o.CollectOptions([this.name],[["near_dropped"],["link","container","storage"],["dropped"]]));n.priority=400,n.id="Remote gather "+this,n.name=n.id,n.idealCreepBody=i.CREEP_TYPE.REMOTE_COURIER,n.capacityCap=0;for(let e of this.sources)n.capacityCap+=e.energyCapacity;if(e.push(n),this.energyHarvestedSinceLastInvasion>7e4||this.invaders.length>0){let t=new h.DefendRoom(this.name);e.push(t)}if(this.invaders.length>0){if(this.energyHarvestedSinceLastInvasion>500){let e=!1;for(let t of this.myCreeps)if(t.type===i.CREEP_TYPE.REMOTE_DEFENDER.name){e=!0;break}e?(console.log("Invasion has occurred while protected by a REMOTE_DEFENDER "+this.energyHarvestedSinceLastInvasion),Game.notify("["+this.name+"] Invasion has occurred while protected by a REMOTE_DEFENDER "+this.energyHarvestedSinceLastInvasion,10)):(console.log("Invasion has occurred with no REMOTE_DEFENDER "+this.energyHarvestedSinceLastInvasion),Game.notify("["+this.name+"] Invasion has occurred with no REMOTE_DEFENDER "+this.energyHarvestedSinceLastInvasion,10))}this.energyHarvestedSinceLastInvasion=0}}{let t=[];for(let e of this.mySpawns)t.push(s.Ptr.from(e));for(let e of this.extensions)t.push(s.Ptr.from(e));if(t.length>0){let r;(r=this.economy.resources[RESOURCE_ENERGY]>0?new c.TransferResource(t,RESOURCE_ENERGY,null,new o.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]])):new c.TransferResource(t,RESOURCE_ENERGY,null,new o.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"],["source"]]))).priority=1300,r.id="Fill Spawns and Extensions "+this,r.name=r.id,e.push(r)}}if(null!=this.storage&&this.storage.storeCapacityRemaining){let t=new c.TransferResource([s.Ptr.from(this.storage)],RESOURCE_ENERGY,null,new o.CollectOptions(null,[["near_dropped"],["link","container"],["dropped"]]));t.priority=100,t.name="Transfer energy to "+s.Ptr.from(this.storage).toHtml(),t.capacityCap=600,e.push(t)}if(this.controller.my){let t=new p.UpgradeRoomController(s.Ptr.from(this.controller));t.collectOptions.roomNames.push(this.name),e.push(t)}if(!this.isReserved&&this.controller.level>=2){let t=_.filter(this.constructionSites,function(e){return!e.doIgnore&&e.structureType===STRUCTURE_RAMPART||e.structureType===STRUCTURE_WALL}),r=_.filter(this.structures,function(e){return(e.structureType!==STRUCTURE_WALL||0!==e.pos.x&&49!==e.pos.x&&0!==e.pos.y&&49!==e.pos.y)&&!(e.doIgnore||e.structureType!==STRUCTURE_RAMPART&&e.structureType!==STRUCTURE_WALL)}.bind(this)),i=_.map(t,function(e){return s.Ptr.from(e)}).concat(_.map(r,function(e){return s.Ptr.from(e)}));if(i.length>0){let t=new m.BuildBarrier(i);t.roomName=this.name,e.push(t)}}if(this.hostileCreeps.length>0||this.friendlyCreeps.length>0)if(this.hostileCreeps.length>5)for(let e of this.ramparts)e.setPublic(!1);else{for(let e of this.hostileCreeps){let t=e.room.lookForByRadiusAt(LOOK_STRUCTURES,e,2,!0);for(let e of t)null!=e.structure&&e.structure.structureType===STRUCTURE_RAMPART&&e.structure.setPublic(!1)}for(let e of this.friendlyCreeps){let t=e.room.lookForByRadiusAt(LOOK_STRUCTURES,e,2,!0);for(let e of t)if(null!=e.structure&&e.structure.structureType===STRUCTURE_RAMPART){let t=e.structure,r=t.pos.lookFor(LOOK_CONSTRUCTION_SITES);null==r||0===r.length?t.setPublic(!0):t.setPublic(!1),t.setPublic(!1)}}}{let t=_.sortBy(this.constructionSites,function(e){return e.progressRemaining});for(let r of t){if(r.doIgnore||!r.my)continue;let t=r.getTasks();r.doFavor&&_.forEach(t,function(e){e.priority=1010}),e.push.apply(e,t)}}if(this.towers.length>0)if(this.hostileCreeps.length>0)for(let e of this.towers){if(null!=e.attackTarget&&null!=e.attackTarget.room&&e.attackTarget.room.name===e.room.name&&e.attackTarget.pos.inRangeTo(e.pos,40)){e.attack(e.attackTarget);continue}e.attackTarget=null;let t=e.pos.findClosestByRange(this.hostileCreeps);t.pos.inRangeTo(e.pos,30)&&(e.attack(t),e.attackTarget=t)}else if(this.injuredFriendlyCreeps.length>0)for(let e of this.towers)console.log("_////////////////////////////////// "+this.injuredFriendlyCreeps[0].name),e.heal(this.injuredFriendlyCreeps[0]);{let t=this.towers.length>0&&0===this.hostileCreeps.length;for(let r of this.structures){if(r.doIgnore)continue;if(null!=r.getTasks){let t=r.getTasks();r.doFavor&&t.forEach(function(e){e.priority=1010}),e.push.apply(e,t)}if(r.structureType===STRUCTURE_CONTROLLER)continue;if(r.structureType===STRUCTURE_WALL||r.structureType===STRUCTURE_RAMPART)continue;let i={ideal:1e4,regular:{threshold:.5,priority:100},dire:{threshold:.85,priority:1e3}};if(null!=g[r.structureType]&&(i=g[r.structureType]),r.needsRepair&&r.hits<i.ideal||r.hits<i.regular.threshold){r.needsRepair=!0;let o=!1;if(t)for(let e of this.towers)if(null==e.repairTarget&&null==e.attackTarget&&e.energyCapacityRemaining<300){e.repair(r),e.repairTarget=r,o=!0;break}if(!1===o){t=!1;let o=new d.RepairStructure(s.Ptr.from(r));o.priority=i.regular.priority,(1==r.dire||r.hits<i.dire.threshold)&&(r.dire=!0,o.priority=i.dire.priority,o.name="Repair "+r),e.push(o)}}else r.needsRepair=!1,r.dire=!1}}return e}}t.SporeRoom=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SporeCostMatrixCache=class{constructor(){this.rootNode=new s("",null)}findCostMatrix(e,t){if(null==t||0===t.length)return null;let r=Game.rooms[e],i=this.rootNode;for(let o of t){let t=`${e}:${o.id}`,n=null;null==i.children&&(i.children=[]);for(let e of i.children)if(e.id===t){n=e;break}if(null==n){let e=i.value;e=null==e?new PathFinder.CostMatrix:i.value.clone();let l=o.targets;if(null==l&&null!=r&&"function"==typeof(l=r[o.id])&&(l=l()),null!=l)for(let t of l)t instanceof RoomPosition?e.set(t.x,t.y,o.cost):e.set(t.pos.x,t.pos.y,o.cost);let a=new s(t,e);i.children.push(a),n=a}i=n}return i.value}};class s{constructor(e,t){this.id=e,this.value=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){this.costs=e,this.persist=t,this.plainCost=1,this.swampCost=5,this.maxRooms=16,this.maxOps=2e3}}s.Default=new s([],null),t.SporePathOptions=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={creep:function(e){return!e.my},energy:function(e){return!1},exit:function(e){return!1},flag:function(e){return!1},mineral:function(e){return!0},nuke:function(e){return!1},resource:function(e){return!1},source:function(e){return!0},structure:function(e){return e.structureType!==STRUCTURE_RAMPART||!e.my},terrain:function(e){return"wall"===e},tombstone:function(e){return!1},powerCreep:function(e){return!e.my}};t.SporeRoomPosition=class extends RoomPosition{static serialize(e){return e.x+","+e.y+","+e.roomName}serialize(){return this.x+","+this.y+","+this.roomName}static deserialize(e){let t=e.split(",");return new RoomPosition(+t[0],+t[1],t[2])}sortByRangeTo(e){let t={};e.sort(function(e,r){let s=t[e.id];null==s&&(null==(s=this.getRangeTo(e))&&(s=50*Game.map.getRoomLinearDistance(this.roomName,e.roomName)),t[e.id]=s);let i=t[r.id];return null==i&&(null==(i=this.getRangeTo(r))&&(i=50*Game.map.getRoomLinearDistance(this.roomName,r.roomName)),t[r.id]=i),s<i?-1:s>i?1:0}.bind(this))}findDistanceByPathTo(e,t){let r=e;return e instanceof RoomPosition||(r=e.pos),PathFinder.search(this,{pos:r,range:1}).path.length}findFirstInRange(e,t){for(let r=0;r<e.length;r++){let s=e[r];if(this.inRangeTo(s.pos,t))return s}return null}findClosestInRange(e,t){let r=500,s=null;for(let t=0;t<e.length;t++){let i=e[t],o=this.getRangeTo(i.pos);o<r&&(r=o,s=i)}return r<=t?s:null}getWalkableSurroundingArea(e=!0){let t=0,r=Game.rooms[this.roomName];if(e||_.isNull(r)){const e=Game.map.getRoomTerrain(this.roomName);for(var i=-1;i<2;i++)for(var o=-1;o<2;o++)0==i&&0==o||e.get(this.x+i,this.y+o)!=TERRAIN_MASK_WALL&&t++}else{let e=r.lookAtArea(this.y-1,this.x-1,this.y+1,this.x+1);for(i=-1;i<2;i++)for(o=-1;o<2;o++){if(0==i&&0==o)continue;let r=e[this.y+o][this.x+i],n=!1;for(let e of r)if(s[e.type](e[e.type])){n=!0;break}!1===n&&t++}}return t}getWalkableSurroundingAreaInRange(e,t,r=!0){let i=[],o=Game.rooms[this.roomName];if(r||_.isNull(o)){const r=Game.map.getRoomTerrain(this.roomName);for(var n=-1;n<2;n++)for(var l=-1;l<2;l++)if((0!=n||0!=l)&&r.get(this.x+n,this.y+l)!=TERRAIN_MASK_WALL){let r=new RoomPosition(this.x+n,this.y+l,e.roomName);e.inRangeTo(r,t)&&i.push(r)}}else{let r=o.lookAtArea(this.y-1,this.x-1,this.y+1,this.x+1);for(n=-1;n<2;n++)for(l=-1;l<2;l++){if(0==n&&0==l)continue;let o=r[this.y+l][this.x+n],a=!1;for(let e of o)if(s[e.type](e[e.type])){a=!0;break}if(!1===a){let r=new RoomPosition(this.x+n,this.y+l,e.roomName);e.inRangeTo(r,t)&&i.push(r)}}}return i}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(7);t.SporeCreepMovement=class{constructor(e){this.memory=e}get improv(){return null!=this.memory.improv&&(this._improv=new s.SporePath(this.memory.improv)),this._improv}set improv(e){null==e?null!=this.memory.improv&&(this._improv=null,this.memory.improv=null,this.mergeIndex=-1,this.pathIndex=-1,this.expectedPosition=null,this.failedMoveAttempts=0):(null==this._improv&&null!=e||null!=this._improv&&!this._improv.isEqualTo(e))&&(this._improv=e,this.memory.improv=this._improv.serialize(),this.mergeIndex=-1,this.expectedPosition=null,this.failedMoveAttempts=0)}get mergeIndex(){return this.memory.mergeIndex}set mergeIndex(e){this.memory.mergeIndex=e}get path(){return null!=this._path?this._path:(null!=this.memory.path&&(this._path=new s.SporePath(this.memory.path)),this._path)}set path(e){null==e?null!=this.memory.path&&(this._path=null,this.memory.path=null,this.pathIndex=-1,this.expectedPosition=null,this.failedMoveAttempts=0,this.improv=null):(null==this._path&&null!=e||null!=this._path&&!this._path.isEqualTo(e))&&(this._path=e,this.memory.path=this._path.serialize(),this.pathIndex=-1,this.expectedPosition=null,this.failedMoveAttempts=0,this.improv=null)}get pathIndex(){return(null==this.memory.pathIndex||null==this.memory.path&&null==this.memory.improv)&&(this.memory.pathIndex=-1),this.memory.pathIndex}set pathIndex(e){this.memory.pathIndex=e}get expectedPosition(){return null!=this._expectedPosition?this._expectedPosition:(null!=this.memory.expectedPosRoomName&&(this._expectedPosition=new RoomPosition(this.memory.expectedPosX,this.memory.expectedPosY,this.memory.expectedPosRoomName)),this._expectedPosition)}set expectedPosition(e){null!=e?(this.memory.expectedPosRoomName=e.roomName,this.memory.expectedPosX=e.x,this.memory.expectedPosY=e.y):(this.memory.expectedPosRoomName=null,this.memory.expectedPosX=null,this.memory.expectedPosY=null)}get failedMoveAttempts(){return this.memory.failedMoveAttempts}set failedMoveAttempts(e){this.memory.failedMoveAttempts=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1),n=r(3),l=r(18);class a extends s.Task{constructor(e){super(!1),this.source=e,this.scheduledWork=0,this.scheduledWorkers=[],this.id="Harvesting "+this.source,this.name="Harvesting "+this.source.toHtml(),this.possibleWorkers=-1,this.priority=1e3,this.idealCreepBody=o.CREEP_TYPE.MINER,this.roomName=this.source.pos.roomName,this.near=e}createAppointment(e,t){return super.createBasicAppointment(e,t,this.source)}getPrioritizingConditions(e){e.push(e=>0===e.carry[RESOURCE_ENERGY]&&e.carryCount===e.carryCapacity?-1:e.type===o.CREEP_TYPE.UPGRADER.name?-1:0),super.getBasicPrioritizingConditions(e,this.source,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWork=0,this.scheduledWorkers.length=0;let e=l.SporeSource.getSlots(this.source);-1===e&&(e=8),this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({work:5},1,e)}schedule(e){if(0===this.possibleWorkers||this.scheduledWork>=1||!this.source.isValid||!this.source.isShrouded&&this.scheduledWorkers.length>=this.source.instance.slots)return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to harvest with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(null==r.spawnRequest&&r.task!=this&&r.task instanceof a)return s.ERR_SKIP_WORKER;if((t=null!=r.spawnRequest?null!=r.spawnRequest.replacingCreep?r.goMoveTo(r.spawnRequest.replacingCreep):r.goMoveTo(this.source):this.source.isShrouded||0!==this.source.instance.energy?r.goHarvest(this.source):r.goMoveTo(this.source))<0&&(r.action=null),r.carry[RESOURCE_ENERGY]>0){let e=r.room.lookForByRadiusAt(LOOK_STRUCTURES,r.pos,1,!0),s=_.groupBy(e,function(e){return e.structure.structureType});if(null!=s[STRUCTURE_STORAGE]&&s[STRUCTURE_STORAGE].length>0){let e=s[STRUCTURE_STORAGE][0].structure;e.storeCapacityRemaining>0&&(t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(e)))}if(null!=s[STRUCTURE_CONTROLLER]&&s[STRUCTURE_CONTROLLER].length>0){let e=s[STRUCTURE_CONTROLLER][0].structure;t=r.goUpgrade(n.Ptr.from(e))}if(null!=s[STRUCTURE_CONTAINER]&&s[STRUCTURE_CONTAINER].length>0)for(let e of s[STRUCTURE_CONTAINER]){let s=e.structure;if(s.storeCapacityRemaining>0){t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(s));break}}if(null!=s[STRUCTURE_LINK]&&s[STRUCTURE_LINK].length>0){let e=s[STRUCTURE_LINK][0].structure;e.energyCapacityRemaining>0&&(t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(e)))}if(null!=s[STRUCTURE_EXTENSION]&&s[STRUCTURE_EXTENSION].length>0){let e=s[STRUCTURE_EXTENSION][0].structure;e.energyCapacityRemaining>0&&(t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(e)))}if(null!=s[STRUCTURE_SPAWN]&&s[STRUCTURE_SPAWN].length>0){let e=s[STRUCTURE_SPAWN][0].structure;e.energyCapacityRemaining>0&&(t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(e)))}if(null!=s[STRUCTURE_TOWER]&&s[STRUCTURE_TOWER].length>0)for(let e of s[STRUCTURE_TOWER]){let s=e.structure;if(s.energyCapacityRemaining>0){t=r.goTransfer(RESOURCE_ENERGY,n.Ptr.from(s));break}}}return t===s.ERR_CANNOT_PERFORM_TASK&&(console.log(r+" is blocked from harvesting"),t=OK),t===OK&&null==r.spawnRequest&&(this.scheduledWork+=r.getActiveBodyparts(WORK)/5,this.scheduledWorkers.push(r),this.possibleWorkers>0&&this.possibleWorkers--),0===this.possibleWorkers||this.scheduledWork>=1||!this.source.isValid||!this.source.isShrouded&&this.scheduledWorkers.length>=this.source.instance.slots?s.NO_MORE_WORK:t}doBusyWork(e,t){if(e.getActiveBodyparts(CARRY)>0){let r=0,i=[];if(0!=t&&console.log("?+?+?+?+?+?+?+?+?+?+?+?+? "+e+" "+t),t!==s.ERR_NO_WORK){i=e.room.lookForByRadiusAt(LOOK_RESOURCES,e.pos,1,!0);for(let e of i)e.resource.resourceType===RESOURCE_ENERGY&&(r+=e.resource.amount)}if(r>2e3||t===s.ERR_NO_WORK){let t=e.room.lookForByRadiusAt(LOOK_STRUCTURES,e.pos,1,!0),r=!1;for(let s of t)if(s.structure.hits<s.structure.hitsMax){null!=i[0]?e.pickup(i[0].resource):e.withdraw(s.structure,RESOURCE_ENERGY),e.repair(s.structure),r=!0;break}if(!r){let t=e.room.lookForByRadiusAt(LOOK_CONSTRUCTION_SITES,e.pos,1,!0);t.length>0&&(null!=i[0]&&e.pickup(i[0].resource),e.build(t[0].constructionSite))}}}}endScheduling(){}}t.HarvestEnergy=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2);class o{constructor(e){this.source=e,this.count=0,this.work=0,this.energy=0}}t.SourceClaims=o;t.SporeSource=class extends Source{get doTrack(){return!0===this.memory.track}static getSlots(e){let t=Memory.rooms[e.pos.roomName];if(null==t)return-1;null==t.sources&&(t.sources={});let r=t.sources[e.id];return null==r&&(r={},t.sources[e.id]=r),null==r.claimSlots&&(r.claimSlots=e.pos.getWalkableSurroundingArea()),r.claimSlots}get slots(){let e=this.memory.claimSlots;return null==e&&(e=this.pos.getWalkableSurroundingArea(),this.memory.claimSlots=e),e}get priorityModifier(){return i.Remember.forTick(`${this.id}.priorityModifier`,()=>{let e=this.memory.pathToClosestSpawn,t=0;if(null==e||Game.time-e.tickCalculated>300){let e=this.colony,r=null;e.cpuSpentPathing<=e.pathingCpuLimit&&(r=e.pathFinder.findPathTo(this.pos,_.map(this.room.mySpawns,e=>({pos:e.pos,range:1})))),null!=r&&(this.memory.pathToClosestSpawn=r.serialize(),t+=Math.max(0,250-r.cost))}else t+=Math.max(0,250-e.cost);return t})}get memory(){let e=this.room.memory;null==e.sources&&(e.sources={});let t=e.sources[this.id];return null==t&&(t={},e.sources[this.id]=t),t}collect(e,t){if(t.target!==this)return ERR_INVALID_TARGET;if(null!=e.harvest){let t=e.harvest(this);return t===OK&&(this.room.energyHarvestedSinceLastInvasion+=2*e.getActiveBodyparts(WORK)),t}return ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){if(t!=RESOURCE_ENERGY||this.claims.count>=this.slots||this.claims.work>=1&&!0===o)return null;let n=r;if(!1===o){let e=this.energy-this.claims.energy;if(n>e){if(i>e)return null;n=e}}return this.claims.count++,this.claims.energy+=n,!0===o&&null!=e.getActiveBodyparts&&(this.claims.work+=e.getActiveBodyparts(WORK)/5),new s.ClaimReceipt(this,"source",t,n)}get claims(){return null!=this._claims&&this._claimTick==Game.time?this._claims:(this._claimTick=Game.time,this._claims=new o(this),this._claims)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1);t.DefendRoom=class extends s.Task{constructor(e){super(!1),this.defendingRoomName=e,this.id="Defending "+e,this.name="Defending ["+e+"]",this.possibleWorkers=-1,this.idealCreepBody=o.CREEP_TYPE.REMOTE_DEFENDER,this.priority=100,this.anchor=new RoomPosition(25,25,this.defendingRoomName);let t=Game.rooms[this.defendingRoomName];null!=t&&t.hostileCreeps.length>0&&(this.priority=1199),this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({},1,1);for(let e in Game.flags){let t=Game.flags[e];if(t.color==COLOR_ORANGE&&t.secondaryColor==COLOR_ORANGE&&t.pos.roomName===this.defendingRoomName){this.anchor=t.pos;break}}}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,this.anchor)}getPrioritizingConditions(e){super.getBasicPrioritizingConditions(e,this.anchor,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWorkers=0}hasWork(){return 0!==this.possibleWorkers&&!(null!=this.labor.types[this.idealCreepBody.name]&&this.scheduledWorkers>=this.labor.types[this.idealCreepBody.name].max)}schedule(e){if(!this.hasWork())return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to defend a room with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(r.pos.roomName!=this.defendingRoomName)t=r.goMoveTo(this.anchor),r.heal(r);else if(0===r.room.hostileCreeps.length)if(r.room.injuredFriendlyCreeps.length>0){let e=r.room.injuredFriendlyCreeps[0];r.heal(e)==ERR_NOT_IN_RANGE?(t=r.moveTo(e),r.rangedHeal(e)==ERR_NOT_IN_RANGE&&r.heal(r)):t=OK}else t=r.goMoveTo(this.anchor);else{let e=null;null!=r.taskMetadata&&null!=r.taskMetadata.target&&r.task==this&&r.taskMetadata.time>=Game.time-15&&(e=Game.getObjectById(r.taskMetadata.target)),null==e&&(e=r.pos.findClosestByPath(r.room.hostileCreeps),r.taskMetadata={target:e.id,time:Game.time}),(t=r.attack(e))===ERR_NOT_IN_RANGE&&((t=r.moveTo(e))===ERR_TIRED&&(t=OK),r.heal(r)),r.rangedAttack(e)}return null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep?OK:(t===OK&&(this.scheduledWorkers++,this.possibleWorkers>0&&this.possibleWorkers--),this.hasWork()?t:s.NO_MORE_WORK)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1),n=r(6);t.UpgradeRoomController=class extends s.Task{constructor(e){if(super(!1),this.controller=e,this.collectOptions=new n.CollectOptions([],[["near_dropped"],["link","container","storage"],["dropped"]]),this.claimable=null,this.id="Upgrade "+e,this.name="Upgrade "+e.toHtml(),this.possibleWorkers=-1,this.idealCreepBody=o.CREEP_TYPE.CITIZEN,this.roomName=e.pos.roomName,this.priority=0,this.near=e,this.upgraderSlots=[],this.remainingUpgraderSlots=[],!e.isShrouded){let t=e.instance.room.lookForByRadiusAt(LOOK_STRUCTURES,e.instance,4,!0);for(let r of t){if(r.structure.structureType===STRUCTURE_STORAGE){this.idealCreepBody=o.CREEP_TYPE.UPGRADER,this.upgraderSlots=r.structure.pos.getWalkableSurroundingAreaInRange(e.instance.pos,3),this.claimable=r.structure;break}r.structure.structureType===STRUCTURE_LINK?(this.idealCreepBody=o.CREEP_TYPE.UPGRADER,this.upgraderSlots=r.structure.pos.getWalkableSurroundingAreaInRange(e.instance.pos,3),this.claimable=r.structure):r.structure.structureType===STRUCTURE_CONTAINER&&this.near===e&&(this.idealCreepBody=o.CREEP_TYPE.UPGRADER,this.upgraderSlots=r.structure.pos.getWalkableSurroundingAreaInRange(e.instance.pos,3),this.claimable=r.structure)}for(let e of this.upgraderSlots)this.remainingUpgraderSlots.push(e);e.instance.ticksToDowngrade<2e3?this.priority=2e3:e.instance.ticksToDowngrade<3e3?this.priority=1e3:e.instance.level<2&&(this.priority=900)}}createAppointment(e,t){return super.createBasicAppointment(e,t,this.controller)}getPrioritizingConditions(e){e.push(e=>0===e.carry[RESOURCE_ENERGY]&&e.carryCount===e.carryCapacity?-1:0),super.getBasicPrioritizingConditions(e,this.controller,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}hasWork(){return!(0===this.possibleWorkers||!this.controller.isValid||null!=this.labor.types[this.idealCreepBody.name]&&(this.scheduledWork>=this.labor.types[this.idealCreepBody.name].parts[WORK]||this.scheduledWorkers>=this.labor.types[this.idealCreepBody.name].max))}beginScheduling(){this.scheduledWorkers=0,this.scheduledWork=0}schedule(e){if(!this.hasWork())return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to upgrade a room controller with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep)return r.goMoveTo(r.spawnRequest.replacingCreep),OK;if(r.type==o.CREEP_TYPE.UPGRADER.name){if(this.remainingUpgraderSlots.length<=0)return s.ERR_CANNOT_PERFORM_TASK;let e=this.remainingUpgraderSlots[0];if(null!=r.taskMetadata&&"UpgradeRC"==r.taskMetadata.type){let t=new RoomPosition(r.taskMetadata.x,r.taskMetadata.y,r.taskMetadata.roomName);for(let r=0;r<this.remainingUpgraderSlots.length;r++)if(this.remainingUpgraderSlots[r].isEqualTo(t)){e=t,this.remainingUpgraderSlots.splice(r,1);break}}else this.remainingUpgraderSlots.splice(0,1);r.pos.isEqualTo(e)?t=OK:(t=r.moveTo(e))===ERR_TIRED&&(t=OK),t>=0&&(r.taskMetadata={type:"UpgradeRC",x:e.x,y:e.y,roomName:e.roomName});let i=this.claimable.makeClaim(this,RESOURCE_ENERGY,r.carryCapacityRemaining,r.getActiveBodyparts(WORK),!1);null!=i&&i.target.collect(r,i),this.controller.isShrouded||r.upgradeController(this.controller.instance),r.action=o.ACTION_UPGRADE,r.actionTarget=this.controller.toString()}else if(r.carry[RESOURCE_ENERGY]===r.carryCapacity||r.action===o.ACTION_UPGRADE&&r.carry[RESOURCE_ENERGY]>0)t=r.goUpgrade(this.controller);else{let e=r.carryCapacityRemaining;(t=r.goCollect(RESOURCE_ENERGY,e,e,!1,this.controller.pos,this.collectOptions,{}))===s.ERR_NO_WORK&&(t=r.carry[RESOURCE_ENERGY]>0?r.goUpgrade(this.controller):r.goCollect(RESOURCE_ENERGY,e,0,!1,this.controller.pos,this.collectOptions,{})),this.controller.isShrouded||r.upgradeController(this.controller.instance)}return t===OK&&(this.scheduledWorkers++,this.scheduledWork+=r.getActiveBodyparts(WORK),this.possibleWorkers>0&&this.possibleWorkers--),this.updateLaborRequirements(),this.hasWork()?t:s.NO_MORE_WORK}updateLaborRequirements(){let e=null;this.controller.isShrouded||(e=this.controller.instance.room);let t=50;this.idealCreepBody.name===o.CREEP_TYPE.UPGRADER.name&&this.upgraderSlots.length>0&&(t=this.upgraderSlots.length),null!=e&&e.level>=8?this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({work:15},1,t):null!=e&&null!=e.economy&&null!=e.economy.resources&&e.economy.resources[RESOURCE_ENERGY]>300*this.scheduledWork?this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({work:this.scheduledWork+1},1,t):(t=this.scheduledWorkers,this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({work:this.scheduledWork},1,t))}endScheduling(){this.updateLaborRequirements()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(6),o=r(3),n=r(0),l=r(4);t.BuildBarrier=class extends n.Task{constructor(e){super(!1),this.barriers=e,this.scheduledWorkers=0,this.scheduledCarry=0,this.direRampartHits=10*RAMPART_DECAY_AMOUNT,this.averageHits=0,this.averageDelta=1e3,this.requiredCarryPerBarrier=.15,this.id="Reinforce barriers "+e[0].pos.roomName,this.name="Reinforce barriers "+e[0].pos.roomName,this.possibleWorkers=-1,this.priority=50,this.idealCreepBody=s.CREEP_TYPE.MASON;let t=0,r=0;for(let s of e)s.isValid&&!s.isShrouded&&s.lookType===LOOK_STRUCTURES&&(r++,t+=s.instance.hits);this.averageHits=t/r,this.labor.types[this.idealCreepBody.name]=new l.LaborDemandType({carry:Math.floor(this.requiredCarryPerBarrier*this.barriers.length)},1,10)}sortBarriers(){this.barriers.sort(function(e,t){const r=e.lookTypeModifier===STRUCTURE_RAMPART,s=t.lookTypeModifier===STRUCTURE_RAMPART,i=e.lookType===LOOK_STRUCTURES,o=t.lookType===LOOK_STRUCTURES,n=e.isShrouded,l=t.isShrouded,a=e.instance,u=t.instance,c=r&&!n&&a.hits<this.direRampartHits,h=s&&!l&&u.hits<this.direRampartHits;if(c&&h){const r=a.hits,s=u.hits;return r===s?this.comparePosition(e,t):r<s?-1:1}if(c&&!h)return-1;if(!c&&h)return 1;if(!i&&!o)return this.comparePosition(e,t);if(i&&!o)return 1;if(!i&&o)return-1;if(n&&l)return this.comparePosition(e,t);if(!n&&l)return-1;if(n&&!l)return 1;let p=a.hits,m=u.hits,d=this.averageHits+this.averageDelta,R=p>=d,y=m>=d;return R&&y?this.comparePosition(e,t):!R&&y?-1:R&&!y?1:p<m?-1:p>m?1:this.comparePosition(e,t)}.bind(this))}comparePosition(e,t){return e.pos.x===t.pos.x?e.pos.y===t.pos.y?0:e.pos.y<t.pos.y?-1:1:e.pos.x<t.pos.x?-1:1}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,new RoomPosition(25,25,this.roomName))}getPrioritizingConditions(e){e.push(e=>0===e.carry[RESOURCE_ENERGY]&&e.carryCount===e.carryCapacity?-1:e.type===s.CREEP_TYPE.MINER.name||e.type===s.CREEP_TYPE.UPGRADER.name?-1:0),super.getBasicPrioritizingConditions(e,new RoomPosition(25,25,this.roomName),this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.sortBarriers(),this.scheduledWorkers=0,this.scheduledCarry=0}hasWork(){return 0!==this.possibleWorkers&&(null==this.labor.types[this.idealCreepBody.name]||!(this.scheduledCarry>=this.labor.types[this.idealCreepBody.name].parts[CARRY]||this.scheduledWorkers>=this.labor.types[this.idealCreepBody.name].max))}schedule(e){if(!(e instanceof Creep))return console.log("ERROR: Attempted to reinforce barriers with a non-creep room object. "+e),n.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep)return r.goMoveTo(r.spawnRequest.replacingCreep),OK;if(!this.hasWork())return n.ERR_NO_WORK;if(r.carry[RESOURCE_ENERGY]===r.carryCapacity||(r.action===s.ACTION_BUILD||r.action===s.ACTION_REPAIR||r.action===s.ACTION_MOVE)&&r.carry[RESOURCE_ENERGY]>0)t=this.goReinforce(r,0);else{r.taskMetadata={type:"BuildBarrier",target:null};let e=r.carryCapacityRemaining;(t=r.goCollect(RESOURCE_ENERGY,e,e,!1,this.barriers[0].pos,new i.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]]),{}))===n.ERR_NO_WORK&&(t=r.carry[RESOURCE_ENERGY]>0?this.goReinforce(r,0):r.goCollect(RESOURCE_ENERGY,e,0,!1,this.barriers[0].pos,new i.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]]),{}))}return t===OK&&(this.scheduledWorkers++,this.scheduledCarry+=r.getActiveBodyparts(CARRY),this.possibleWorkers>0&&this.possibleWorkers--),this.hasWork()?t:n.NO_MORE_WORK}goReinforce(e,t){let r,s=this.barriers[t];if(null!=e.taskMetadata&&"BuildBarrier"===e.taskMetadata.type&&null!=e.taskMetadata.target){let t=e.taskMetadata.target,r=Game.getObjectById(t);null!=r&&(s=o.Ptr.from(r))}return r=this.barriers[t].lookType===LOOK_CONSTRUCTION_SITES?e.goBuild(s):e.goRepair(s),e.taskMetadata={type:"BuildBarrier",target:s.id},r}endScheduling(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(1),o=r(6);t.RepairStructure=class extends s.Task{constructor(e){super(!1),this.structure=e,this.id="Repair [structure ("+e.lookTypeModifier+") {room "+this.structure.pos.roomName+"}]",this.name="Repair "+e.toHtml(),this.priority=75,this.possibleWorkers=2,this.idealCreepBody=i.CREEP_TYPE.CITIZEN,this.near=e,this.roomName="E1N49"}getPrioritizingConditions(e){e.push(e=>0===e.carry[RESOURCE_ENERGY]&&e.carryCount===e.carryCapacity?-1:e.type===i.CREEP_TYPE.MINER.name||e.type===i.CREEP_TYPE.UPGRADER.name?-1:0),super.getBasicPrioritizingConditions(e,this.structure,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}schedule(e){if(0==this.possibleWorkers)return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to harvest with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(r.carry[RESOURCE_ENERGY]===r.carryCapacity||(r.action===i.ACTION_REPAIR||r.action===i.ACTION_MOVE)&&r.carry[RESOURCE_ENERGY]>0)t=r.goRepair(this.structure);else{let e=r.carryCapacityRemaining;this.structure.isShrouded||Math.min(r.carryCapacityRemaining,this.structure.instance.hitsMissing/100),t=r.goCollect(RESOURCE_ENERGY,e,e,!1,this.structure.pos,new o.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]]),{})}return t===OK&&this.possibleWorkers>0&&this.possibleWorkers--,t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1);t.Wire=class extends s.Task{constructor(e){super(!1),this.pos=e,this.id=`Wiring ${e}`,this.name=`Wiring {room ${e.roomName} pos ${e.x},${e.y}}`,this.possibleWorkers=-1,this.idealCreepBody=o.CREEP_TYPE.WIRE,this.priority=450,this.anchor=e,this.roomName=e.roomName,this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({},1,1)}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,this.anchor)}getPrioritizingConditions(e){super.getBasicPrioritizingConditions(e,this.anchor,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWorkers=0}hasWork(){return 0!==this.possibleWorkers&&!(null!=this.labor.types[this.idealCreepBody.name]&&this.scheduledWorkers>=this.labor.types[this.idealCreepBody.name].max)}schedule(e){if(!this.hasWork())return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to defend a room with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let t,r=e;if(null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep)return r.goMoveTo(r.spawnRequest.replacingCreep),OK;if(r.pos.isEqualTo(this.pos)){t=OK;let e=r.room.lookForByRadiusAt(LOOK_STRUCTURES,r,1,!0);for(let t of e)t.structure.structureType===STRUCTURE_LINK&&r.withdraw(t.structure,RESOURCE_ENERGY),t.structure.structureType===STRUCTURE_TERMINAL?r.withdraw(t.structure,RESOURCE_ENERGY):t.structure.structureType===STRUCTURE_STORAGE&&r.transfer(t.structure,RESOURCE_ENERGY)}else(t=r.moveTo(this.pos))===ERR_TIRED&&(t=OK);return t===OK&&(this.scheduledWorkers++,this.possibleWorkers>0&&this.possibleWorkers--),this.hasWork()?t:s.NO_MORE_WORK}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(0),o=r(4);t.ClaimRoom=class extends i.Task{constructor(e){super(!1),this.controller=e,this.id="Claim "+e,this.name="Claim "+e.toHtml(),this.possibleWorkers=-1,this.idealCreepBody=s.CREEP_TYPE.CLAIMER,this.near=e,this.priority=75,e.isShrouded||null==e.instance.owner||(this.priority=-1),this.labor.types[this.idealCreepBody.name]=new o.LaborDemandType({claim:1},1,1)}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,this.controller)}getPrioritizingConditions(e){super.getBasicPrioritizingConditions(e,this.controller,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledClaim=0}schedule(e){if(0===this.possibleWorkers||!this.controller.isValid||this.scheduledClaim>=this.labor.types[this.idealCreepBody.name].parts[CLAIM])return i.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to reserve a controller with a non-creep room object. "+e),i.ERR_CANNOT_PERFORM_TASK;let t,r=e;return null!=r.spawnRequest&&null!=r.spawnRequest.replacingCreep?(r.goMoveTo(r.spawnRequest.replacingCreep),OK):((t=r.goClaim(this.controller))===OK&&(this.scheduledClaim+=r.getActiveBodyparts(CLAIM),this.possibleWorkers>0&&this.possibleWorkers--),0===this.possibleWorkers||this.scheduledClaim>=this.labor.types[this.idealCreepBody.name].parts[CLAIM]?i.NO_MORE_WORK:t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(4),o=r(1);class n extends s.Task{constructor(e){super(!1),this.controller=e,this.id="Reserve "+e,this.name="Reserve "+e.toHtml(),this.possibleWorkers=-1,this.idealCreepBody=o.CREEP_TYPE.RESERVER,this.near=e,this.roomName=e.pos.roomName,e.isShrouded?this.priority=900:null!=e.instance.reservation&&e.instance.reservation.ticksToEnd<1e3?this.priority=1400:this.priority=100,(e.isShrouded||null==e.instance.reservation||e.instance.reservation.ticksToEnd<1500)&&(this.labor.types[this.idealCreepBody.name]=new i.LaborDemandType({claim:2},1,2))}createAppointment(e,t){return null!=t.replacingCreep?super.createBasicAppointment(e,t,t.replacingCreep):super.createBasicAppointment(e,t,this.controller)}shouldPlanToReplace(e){return!!(e instanceof Creep&&(this.controller.isShrouded||null==this.controller.instance.reservation||"PCake0rigin"!=this.controller.instance.reservation.username||this.controller.instance.reservation.ticksToEnd-e.ticksToLive<1500))}getPrioritizingConditions(e){super.getBasicPrioritizingConditions(e,this.controller,this.idealCreepBody)}isIdeal(e){return e instanceof Creep&&e.type===this.idealCreepBody.name}beginScheduling(){this.scheduledWorkers=0,this.scheduledClaim=0}schedule(e){let t=0;if(null!=this.labor.types[this.idealCreepBody.name]&&(t=this.labor.types[this.idealCreepBody.name].parts[CLAIM]),0===this.possibleWorkers||!this.controller.isValid||t>0&&this.scheduledClaim>=t)return s.ERR_NO_WORK;if(!(e instanceof Creep))return console.log("ERROR: Attempted to reserve a controller with a non-creep room object. "+e),s.ERR_CANNOT_PERFORM_TASK;let r,i=e;return null!=i.spawnRequest&&null!=i.spawnRequest.replacingCreep?(i.goMoveTo(i.spawnRequest.replacingCreep),OK):null==i.spawnRequest&&i.task!=this&&i.task instanceof n?s.ERR_SKIP_WORKER:((r=i.goReserve(this.controller))===OK&&(this.scheduledWorkers++,this.scheduledClaim+=i.getActiveBodyparts(CLAIM),this.possibleWorkers>0&&this.possibleWorkers--),0===this.possibleWorkers||this.scheduledClaim>=t||!this.controller.isShrouded&&this.scheduledWorkers>=this.controller.instance.slots?s.NO_MORE_WORK:r)}}t.ReserveRoom=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LaborPoolType=class{constructor(e,t){this.parts=e,this.count=t;for(let t in BODYPART_COST)null==e[t]&&(e[t]=0)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.RecycleCreep=class extends s.Task{constructor(e){super(!1),this.spawn=e,this.id="Recycle "+e,this.priority=75,this.name="Recycling at "+e,this.possibleWorkers=-1,this.near=e}getPrioritizingConditions(e){e.push(e=>(50-e.body.length)/50)}isIdeal(e){return!1}schedule(e){if(!(0!==this.possibleWorkers&&this.spawn.isValid&&e instanceof Creep))return s.ERR_NO_WORK;let t=e.goRecycle(this.spawn);return t==OK&&this.possibleWorkers>0&&this.possibleWorkers--,t}}},function(e,t,r){e.exports=r(29)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(30),i=r(52),o=r(2),n=r(3),l=r(55),a=r(7),u=r(16),c=r(13),h=r(0),p=r(21),m=r(10),d=r(24),R=r(11),y=r(19),g=r(17),f=r(27),E=r(22),T=r(25),_=r(8),C=r(20),O=r(23);s.Spore.inject();const S=r(56);S.enable(),S.registerClass(o.Remember,"Remember"),S.registerClass(n.Ptr,"Ptr"),S.registerClass(i.SporeColony,"SporeColony"),S.registerClass(a.SporePathFinder,"SporePathFinder"),S.registerClass(a.SporePath,"SporePath"),S.registerClass(u.SporeCreepMovement,"SporeCreepMovement"),S.registerClass(c.SporeCostMatrixCache,"SporeCostMatrixCache"),S.registerClass(h.Task,"Task"),S.registerClass(p.BuildBarrier,"BuildBarrier"),S.registerClass(m.BuildStructure,"BuildStructure"),S.registerClass(d.ClaimRoom,"ClaimRoom"),S.registerClass(R.DismantleStructure,"DismantleStructure"),S.registerClass(y.DefendRoom,"DefendRoom"),S.registerClass(g.HarvestEnergy,"HarvestEnergy"),S.registerClass(f.RecycleCreep,"RecycleCreep"),S.registerClass(E.RepairStructure,"RepairStructure"),S.registerClass(T.ReserveRoom,"RepairReserveRoom"),S.registerClass(_.TransferResource,"TransferResource"),S.registerClass(C.UpgradeRoomController,"UpgradeRoomController"),S.registerClass(O.Wire,"Wire"),e.exports.loop=function(){S.wrap(function(){if(PathFinder.use(!0),o.Remember.beginTick(),!Memory.scriptVersion||Memory.scriptVersion!=l.SCRIPT_VERSION){Memory.scriptVersion=l.SCRIPT_VERSION;const e="<<<<< NEW CODE LOADED >>>>>";(new RoomVisual).text(e,25,25,{color:"green",font:2.5}),console.log(e)}null==Memory.config&&(Memory.config={tasks:{}});for(let e in Memory.creeps)Game.creeps[e]||(delete Memory.creeps[e],console.log("Clearing non-existing creep memory:",e));s.Spore.colony=new i.SporeColony,s.Spore.colony.run(),o.Remember.endTick()})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(12),i=r(1),o=r(18),n=r(37),l=r(38),a=r(39),u=r(40),c=r(41),h=r(42),p=r(15),m=r(45),d=r(46),R=r(47),y=r(48),g=r(49),f=r(50);class E{constructor(){}static inject(){function e(e,...t){return t.forEach(t=>{let r=Object.getOwnPropertyNames(t).reduce((e,r)=>("constructor"!=r&&"colony"!=r&&(e[r]=Object.getOwnPropertyDescriptor(t,r),e[r].enumerable=!0),e),{});Object.getOwnPropertySymbols(t).forEach(e=>{let s=Object.getOwnPropertyDescriptor(t,e);s.enumerable&&(r[e]=s)}),Object.defineProperties(e,r),null==e.colony&&Object.defineProperty(e,"colony",{get:function(){return E.colony},configurable:!0})}),e}e(ConstructionSite.prototype,l.SporeConstructionSite.prototype),e(StructureContainer.prototype,a.SporeContainer.prototype),e(StructureController.prototype,u.SporeController.prototype),e(Creep.prototype,i.SporeCreep.prototype),e(StructureExtension.prototype,c.SporeExtension.prototype),e(Flag.prototype,h.SporeFlag.prototype),e(Room.prototype,s.SporeRoom.prototype),e(RoomObject.prototype,n.SporeRoomObject.prototype),e(RoomPosition.prototype,p.SporeRoomPosition.prototype),e(Source.prototype,o.SporeSource.prototype),e(StructureSpawn.prototype,m.SporeSpawn.prototype),e(StructureStorage.prototype,d.SporeStorage.prototype),e(Structure.prototype,R.SporeStructure.prototype),e(StructureTower.prototype,y.SporeTower.prototype),e(Resource.prototype,g.SporeResource.prototype),e(StructureLink.prototype,f.SporeLink.prototype)}}E.colony=null,t.Spore=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LaborDemand=class{constructor(){this.types={}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9);t.SpawnAppointment=class extends s.SpawnRequest{constructor(e,t,r,s,i,o,n){super(e,t,o,n),this.id=e,this.task=t,this.spawnPriority=r,this.spawn=s,this.ticksTillRequired=i,this.replacingCreep=o,this.creepBody=n}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BodyDefinition=class{constructor(e){this.name=e,this.requirements=[]}getPossibleParts(e){for(let t of this.requirements)if(t.type===e)return t.max;return 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BodyPartRequirements=class{constructor(e,t,r,s){this.type=e,this.max=t,this.min=r,this.increment=s}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Economy=class{constructor(){this.resources={},this.demand={};for(let e of RESOURCES_ALL)this.resources[e]=0,this.demand[e]=0}countStoreResources(e){for(let t in e)null==this.resources[t]&&(this.resources[t]=0),this.resources[t]+=e[t]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Budget=class{constructor(){this.savings={}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SporeRoomObject=class extends RoomObject{get doTrack(){return!0===this.memory.track}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(3),i=r(10);t.SporeConstructionSite=class extends ConstructionSite{get progressRemaining(){return this.progressTotal-this.progress}get memory(){let e=this.room.memory;null==e.sites&&(e.sites={});let t=e.sites[this.id];return null==t&&(t={},e.sites[this.id]=t),t}getTasks(){let e=[];if(this.structureType!==STRUCTURE_RAMPART&&this.structureType!==STRUCTURE_WALL){let t=new i.BuildStructure(s.Ptr.from(this));e.push(t)}return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(3),o=r(6),n=r(2),l=r(8);t.SporeContainer=class extends StructureContainer{get storeCount(){return _.sum(this.store)}get storeCapacityRemaining(){return this.storeCapacity-this.storeCount}getTasks(){let e=[],t=this.pos.findClosestInRange(this.room.sources,2),r=!1;if(null!=this.room.extractor&&(r=!0===this.pos.inRangeTo(this.room.extractor.pos,2)),null==t&&!r){let t=new l.TransferResource([i.Ptr.from(this)],RESOURCE_ENERGY,null,new o.CollectOptions(null,[["near_dropped"],["container"],["dropped"]]));t.priority=0,t.name="Fill "+i.Ptr.from(this).toHtml(),e.push(t)}return e}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.store[t.resourceType],e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){null==this.claims[t]&&(this.claims[t]=0);let n=r,l=this.store[t]-this.claims[t];if(n>l){if(i>l)return null;n=l}return this.claims.count++,this.claims[t]+=n,new s.ClaimReceipt(this,"container",t,n)}get claims(){return n.Remember.byName(`container.${this.id}`,"claims",()=>new a(this))}};class a{constructor(e){this.container=e,this.count=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SporeController=class extends StructureController{get memory(){let e=this.room.memory,t=e.controller;return null==t&&(t={},e.controller=t),t}static getSlots(e){if(e.isShrouded)return 1;let t=e.instance.memory;return null==t.claimSlots&&(t.claimSlots=e.pos.getWalkableSurroundingArea()),t.claimSlots}get slots(){let e=this.memory.claimSlots;return null==e&&(e=this.pos.getWalkableSurroundingArea(),this.memory.claimSlots=e),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2);t.SporeExtension=class extends StructureExtension{get energyCapacityRemaining(){return this.energyCapacity-this.energy}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:t.resourceType===RESOURCE_ENERGY&&null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.energy,e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){if(t!=RESOURCE_ENERGY)return null;let n=r,l=this.energy-this.claims.energy;if(n>l){if(i>l)return null;n=l}return this.claims.count++,this.claims.energy+=n,new s.ClaimReceipt(this,"spawn",t,n)}get claims(){return i.Remember.byName(`extension.${this.id}`,"claims",()=>new o(this))}};class o{constructor(e){this.extension=e,this.count=0,this.energy=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(43),i=r(44),o=r(23),n=r(24),l=r(25),a=r(3);t.SporeFlag=class extends Flag{getTasks(){let e=[];if(null!=this.room&&this.room.my,this.color==COLOR_GREEN)e.push(new s.FlagBuildStructure("",Game.flags[this.name]));else if(this.color==COLOR_RED)e.push(new i.FlagDismantleStructure("",Game.flags[this.name]));else if(this.color==COLOR_WHITE)e.push(new o.Wire(Game.flags[this.name].pos));else if(this.color==COLOR_GREY){if(null!=this.room){let e=this.room.lookAt(this);for(var t=0;t<e.length;t++){let r=e[t];r.type==LOOK_SOURCES?r.source.doIgnore=!0:r.type==LOOK_STRUCTURES?r.structure.doIgnore=!0:r.type==LOOK_CONSTRUCTION_SITES&&(r.constructionSite.doIgnore=!0)}}}else if(this.color==COLOR_BLUE){if(null!=this.room){let e=this.room.lookAt(this);for(t=0;t<e.length;t++){let r=e[t];r.type==LOOK_SOURCES?r.source.doFavor=!0:r.type==LOOK_STRUCTURES?r.structure.doFavor=!0:r.type==LOOK_CONSTRUCTION_SITES&&(r.constructionSite.doFavor=!0)}}}else if(this.color==COLOR_PURPLE)if(this.secondaryColor==COLOR_PURPLE)null==this.room||null!=this.room.controller&&null==this.room.controller.owner?e.push(new n.ClaimRoom(a.Ptr.fromPosition(this.pos,LOOK_STRUCTURES,STRUCTURE_CONTROLLER))):null!=this.room&&null!=this.room.controller&&null!=this.room.controller.owner&&"PCake0rigin"==this.room.controller.owner.username&&this.remove();else if(this.secondaryColor==COLOR_BLUE)if(null==this.room||null!=this.room.controller&&null==this.room.controller.owner&&(null==this.room.controller.reservation||"PCake0rigin"==this.room.controller.reservation.username)){let t=new l.ReserveRoom(a.Ptr.fromPosition(this.pos,LOOK_STRUCTURES,STRUCTURE_CONTROLLER));t.roomName="E1N49",e.push(t)}else null!=this.room&&"PCake0rigin"==this.room.controller.owner.username&&this.remove();return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(10),o=r(11),n=r(3);var l={};class a extends s.Task{constructor(e,t){super(!0),this.flag=t,this.structureType=null,this.id=(null!=e&&e.length>0?e+">":"")+"FlagBuildStructure["+t.name+"]",this.flag.secondaryColor==COLOR_GREEN?this.structureType=STRUCTURE_EXTENSION:this.flag.secondaryColor==COLOR_YELLOW?this.structureType=STRUCTURE_CONTAINER:this.flag.secondaryColor==COLOR_BROWN?this.structureType=STRUCTURE_TOWER:this.flag.secondaryColor==COLOR_CYAN?this.structureType=STRUCTURE_LINK:this.flag.secondaryColor==COLOR_BLUE&&(this.structureType=STRUCTURE_STORAGE)}static deserialize(e){let t="",r=e.lastIndexOf(">");r>=0&&(t=e.substring(0,r));let s=e.lastIndexOf("["),i=e.substring(s,e.length-1),o=Game.flags[i];return null==o?null:new a(t,o)}getSteps(){let e,t=[];if(null==this.structureType)return t;let r=this.flag.room.lookForAt(LOOK_CONSTRUCTION_SITES,this.flag.pos);if(null!=r&&r.length>0)for(let t=0;t<r.length;t++){let s=r[t].structureType;s!=this.structureType&&s!=STRUCTURE_RAMPART&&s!=STRUCTURE_ROAD?r[t].remove():s==this.structureType&&(e=r[t])}if(null!=e)return this.flag.remove(),t;let s=this.flag.room.lookForAt(LOOK_STRUCTURES,this.flag.pos);if(null!=s)for(let e=0;e<s.length;e++){let r=s[e].structureType;if(r==this.structureType)return this.flag.remove(),t;if(r!=STRUCTURE_RAMPART&&r!=STRUCTURE_ROAD)return t.push(new o.DismantleStructure(n.Ptr.from(s[e]))),t}if(null==e){let e=this.flag.room[this.structureType+"s"];null==e&&(e=this.flag.room.find(FIND_STRUCTURES,{filter:{structureType:this.structureType}}));let r=this.flag.room.find(FIND_CONSTRUCTION_SITES,{filter:{structureType:this.structureType}}),s=0;return null!=l[this.structureType]&&(s=l[this.structureType]),CONTROLLER_STRUCTURES[this.structureType][this.flag.room.controller.level]-(e.length+r.length+s)>0?(this.flag.room.createConstructionSite(this.flag.pos,this.structureType),null!=l[this.structureType]?l[this.structureType]++:l[this.structureType]=1,t):t}return t.push(new i.BuildStructure(n.Ptr.from(e))),t}}t.FlagBuildStructure=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),i=r(11),o=r(3);class n extends s.Task{constructor(e,t){super(!0),this.flag=t,this.id=(null!=e&&e.length>0?e+">":"")+"FlagDismantleStructure["+t.name+"]",this.flag.secondaryColor==COLOR_RED?this.structureType=null:this.flag.secondaryColor==COLOR_GREEN?this.structureType=STRUCTURE_EXTENSION:this.flag.secondaryColor==COLOR_YELLOW&&(this.structureType=STRUCTURE_CONTAINER)}static deserialize(e){let t="",r=e.lastIndexOf(">");r>=0&&(t=e.substring(0,r));let s=e.lastIndexOf("["),i=e.substring(s,e.length-1),o=Game.flags[i];return null==o?null:new n(t,o)}getSteps(){let e=[];if(null!=this.flag.room){let t=this.flag.room.lookForAt(LOOK_CONSTRUCTION_SITES,this.flag.pos);if(null!=t&&t.length>0)for(let e=0;e<t.length;e++){let r=t[e].structureType;null!=this.structureType&&r!=this.structureType||t[e].remove()}let r=this.flag.room.lookForAt(LOOK_STRUCTURES,this.flag.pos);if(null!=r)for(let t=0;t<r.length;t++){let s=r[t].structureType;null!=this.structureType&&this.structureType!=s||e.push(new i.DismantleStructure(o.Ptr.from(r[t])))}}return e}}t.FlagDismantleStructure=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2);t.SporeSpawn=class extends StructureSpawn{get energyCapacityRemaining(){return this.energyCapacity-this.energy}getBody(e,t){null==t&&(t=this.room.energyCapacityAvailable);let r=[],s=0,i=e.requirements.length,o=0,n=[];for(let l=0;l<50;++l){let l=null,a=o;a>=i&&(a=0,o=i-1);do{let t=e.requirements[a];if(null==n[a]||n[a]<t.max){l=BODYPART_COST[t.type]*t.increment,o=a+1;break}++a>=i&&(a=0)}while(o!=a);if(null==l)break;if(!(s+l<=t))break;{s+=l;let t=e.requirements[o-1];null==n[o-1]&&(n[o-1]=0);let i=Math.floor(n[o-1]);n[o-1]+=t.increment;let a=Math.floor(n[o-1])-i;for(let e=0;e<a;++e)t.type===TOUGH?r.unshift(t.type):r.push(t.type)}}return r.reverse()}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:t.resourceType===RESOURCE_ENERGY&&null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.energy,e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){if(t!=RESOURCE_ENERGY||r>this.energy-this.claims.energy)return null;let n=r,l=this.energy-this.claims.energy;if(n>l){if(i>l)return null;n=l}return this.claims.count++,this.claims.energy+=n,new s.ClaimReceipt(this,"spawn",t,n)}get claims(){return i.Remember.byName(`spawn.${this.id}`,"claims",function(){return new o(this)}.bind(this))}};class o{constructor(e){this.spawn=e,this.count=0,this.energy=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2);t.SporeStorage=class extends StructureStorage{get storeCount(){return _.sum(this.store)}get storeCapacityRemaining(){return this.storeCapacity-this.storeCount}get memory(){let e=this.room.memory,t=e.storage;return null==t&&(t={},e.storage=t),t}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.store[t.resourceType],e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){null==this.claims[t]&&(this.claims[t]=0);let n=r,l=0;null!=this.room.budget.savings[t]&&this.room.budget.savings[t]>0&&(l=this.room.budget.savings[t]);let a=this.store[t]-this.claims[t];if(n>(a=Math.max(a-l,0))){if(i>a)return null;n=a}return this.claims.count++,this.claims[t]+=n,new s.ClaimReceipt(this,"storage",t,n)}get claims(){return i.Remember.byName(`storage.${this.id}`,"claims",function(){return new o(this)}.bind(this))}};class o{constructor(e){this.storage=e,this.count=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SporeStructure=class extends Structure{get hitsMissing(){return this.hitsMax-this.hits}get needsRepair(){if(null!=this._needsRepair)return!0===this._needsRepair;let e=this.memory;return null==e&&(null==this.room.memory.structures&&(this.room.memory.structures={}),null==(e=this.room.memory.structures[this.id])&&(e={},this.room.memory.structures[this.id]=e)),this._needsRepair=e.needsRepair,!0===this._needsRepair}set needsRepair(e){if(this._needsRepair=e,null!=this.memory)!1===e?delete this.memory.needsRepair:this.memory.needsRepair=e;else{null==this.room.memory.structures&&(this.room.memory.structures={});let t=this.room.memory.structures[this.id];null==t?!0===e&&(this.room.memory.structures[this.id]={},t.needsRepair=e):!0===e?t.needsRepair=e:(delete t.needsRepair,0===Object.getOwnPropertyNames(t).length&&delete this.room.memory.structures[this.id])}}get dire(){if(null!=this._dire)return!0===this._dire;let e=this.memory;return null==e&&(null==this.room.memory.structures&&(this.room.memory.structures={}),null==(e=this.room.memory.structures[this.id])&&(e={},this.room.memory.structures[this.id]=e)),this._dire=e.dire,!0===this._dire}set dire(e){if(this._dire=e,null!=this.memory)!1===e?delete this.memory.dire:this.memory.dire=e;else{null==this.room.memory.structures&&(this.room.memory.structures={});let t=this.room.memory.structures[this.id];null==t?!0===e&&(this.room.memory.structures[this.id]={},t.dire=e):!0===e?t.dire=e:(delete t.dire,0===Object.getOwnPropertyNames(t).length&&delete this.room.memory.structures[this.id])}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(8),i=r(2),o=r(3),n=r(6);t.SporeTower=class extends StructureTower{get attackTarget(){return null!=this._attackTarget?this._attackTarget:(null!=this.memory.attackTargetId&&(this._attackTarget=Game.getObjectById(this.memory.attackTargetId)),this._attackTarget)}set attackTarget(e){this._attackTarget=e,null!=e&&null!=e.id?this.memory.attackTargetId=e.id:delete this.memory.attackTargetId}get energyCapacityRemaining(){return this.energyCapacity-this.energy}get memory(){let e=this.room.memory;null==e.structures&&(e.structures={});let t=e.structures[this.id];return null==t&&(t={},e.structures[this.id]=t),t}getTasks(){let e=[];if(this.energy<this.energyCapacity){let t=new s.TransferResource([o.Ptr.from(this)],RESOURCE_ENERGY,null,new n.CollectOptions(null,[["near_dropped"],["link","container","storage"],["dropped"]]));t.priority=1e3,t.name="Fill "+o.Ptr.from(this).toHtml(),e.push(t)}return e}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:t.resourceType===RESOURCE_ENERGY&&null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.energy,e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,s,i){if(t!=RESOURCE_ENERGY)return null;let o=r,n=this.energy-this.claims.energy;if(o>n){if(s>n)return null;o=n}return this.claims.count++,this.claims.energy+=o,new ClaimReceipt(this,"spawn",t,o)}get claims(){return i.Remember.byName(`tower.${this.id}`,"claims",()=>new l(this))}};class l{constructor(e){this.tower=e,this.count=0,this.energy=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2);t.SporeResource=class extends Resource{collect(e,t){return t.target!==this?ERR_INVALID_TARGET:t.resourceType===this.resourceType&&null!=e.withdraw&&null!=e.carryCapacityRemaining?e.pickup(this):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){if(t!=this.resourceType)return null;let n=r,l=this.amount-this.claims.amount;if(n>l){if(i>l)return null;n=l}return this.claims.count++,this.claims.amount+=n,new s.ClaimReceipt(this,"dropped",t,n)}get claims(){return i.Remember.byName(`resource.${this.id}`,"claims",()=>new o(this))}};class o{constructor(e){this.resource=e,this.count=0,this.amount=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(2),o=r(51);t.SporeLink=class extends StructureLink{get energyCapacityRemaining(){return this.energyCapacity-this.energy}get takesTransfers(){return!0===this.memory.takesTransfers}set takesTransfers(e){this.memory.takesTransfers=e}get bond(){if(null!=this._bond)return this._bond;if(null!=this.memory.bondTargetId)if(this._bond=new o.Bond,this._bond.type=this.memory.bondType,this._bond.targetId=this.memory.bondTargetId,this._bond.target=Game.getObjectById(this.memory.bondTargetId),this._bond.targetFlag=Game.flags[this.memory.bondTargetFlagName],this._bond.myFlag=Game.flags[this.memory.bondMyFlagName],this._bond.exists()){if(null==this._bond.targetId&&null!=this._bond.targetFlag.room){if(null!=this._bond.targetFlag.room){let e=this._bond.targetFlag.room.lookForAt(this._bond.type,this._bond.targetFlag);e.length>0&&(this._bond.target=e[0])}null!=this._bond.target&&(this._bond.targetId=this._bond.target.id),null==this._bond.target&&(this._bond=null,delete this.memory.bondTargetId,delete this.memory.bondTargetFlagName,delete this.memory.bondMyFlagName,delete this.memory.bondType)}}else this._bond=null,delete this.memory.bondTargetId,delete this.memory.bondTargetFlagName,delete this.memory.bondMyFlagName,delete this.memory.bondType;return this._bond}set bond(e){this._bond=e,null==e?(delete this.memory.bondType,delete this.memory.bondTargetId,delete this.memory.bondTargetFlagName,delete this.memory.bondMyFlagName):(this.memory.bondType=e.type,null!=e.target&&(this.memory.bondTargetId=e.target.id),null!=e.targetFlag&&(this.memory.bondTargetFlagName=e.targetFlag.name),null!=e.myFlag&&(this.memory.bondMyFlagName=e.myFlag.name))}get nearBySource(){return i.Remember.byName(`link.${this.id}`,"nearBySource",()=>{if(null!=this.memory.nearBySourceId)return Game.getObjectById(this.memory.nearBySourceId);let e=this.pos.findClosestInRange(this.room.sources,2);return this.memory.nearBySourceId=null==e?"":e.id,e})}get memory(){let e=this.room.memory;null==e.structures&&(e.structures={});let t=e.structures[this.id];return null==t&&(t={},e.structures[this.id]=t),t}getTasks(){this.memory.takesTransfers=!1;let e=null;return null==this.nearBySource&&(this.takesTransfers=!0),"5d0ae2635bf1730d8cfefd35"===this.id&&(this.takesTransfers=!1),this.energy>0&&!this.takesTransfers&&null!=(e=this.findLinkTakingTransfers())&&this.transferEnergy(e),[]}findLinkTakingTransfers(){for(let e of this.room.links)if(!0===e.takesTransfers&&e.energyCapacityRemaining>0)return e;return null}collect(e,t){return t.target!==this?ERR_INVALID_TARGET:null!=e.withdraw&&null!=e.carryCapacityRemaining?e.withdraw(this,t.resourceType,Math.min(this.energy,e.carryCapacityRemaining)):ERR_INVALID_ARGS}makeClaim(e,t,r,i,o){if(!0!==this.takesTransfers||t!=RESOURCE_ENERGY)return null;let n=r,l=this.energy-this.claims.energy;if(n>l){if(i>l)return null;n=l}return this.claims.count++,this.claims.energy+=n,new s.ClaimReceipt(this,"link",t,n)}get claims(){return i.Remember.byName(`link.${this.id}`,"claims",()=>new n(this))}};class n{constructor(e){this.link=e,this.count=0,this.energy=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{exists(){return null!=this.type&&null!=this.targetFlag&&null!=this.myFlag&&this.myFlag.color===COLOR_YELLOW&&this.targetFlag.color===COLOR_YELLOW&&this.myFlag.secondaryColor===this.targetFlag.secondaryColor}static discover(e,t){let r=null,i=null,o=e.room.lookForAt(LOOK_FLAGS,e.pos);for(let e=0;e<o.length;e++){let t=o[e];if(t.color===COLOR_YELLOW){r=t;break}}if(null==r)return null;for(let e in Game.flags){let t=Game.flags[e];if(t!=r&&t.color===COLOR_YELLOW&&t.secondaryColor===r.secondaryColor&&(n=t.name,l=r.name,a=(a=void 0)||0,n.substr(a,l.length)===l)){i=t;break}}var n,l,a;if(null==i)return null;let u=new s;if(u.type=t,u.target=null,u.targetId=null,null!=i.room){let e=i.room.lookForAt(t,i);e.length>0&&(u.target=e[0])}return null!=u.target&&(u.targetId=u.target.id),u.targetFlag=i,u.myFlag=r,u}}t.Bond=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(53),o=r(0),n=r(1),l=r(54),a=r(26),u=r(9),c=r(12),h=r(3),p=r(27),m=r(7);var d={source:function(e,t,r,s,i,o){if(t===RESOURCE_ENERGY&&s instanceof Creep&&0!==s.getActiveBodyparts(WORK))for(let t of this.sources)!0!==t.doIgnore&&t.energy>0&&null==o[t.id]&&e.push(t)},near_dropped:function(e,t,r,s,i,o){let n=s.pos.findInRange(FIND_DROPPED_RESOURCES,5);for(let r of n)!0!==r.doIgnore&&r.resourceType===t&&r.amount>0&&null==o[r.id]&&e.push(r);if(null!=i){let r=i.findInRange(FIND_DROPPED_RESOURCES,5);for(let s of r)!0!==s.doIgnore&&s.resourceType===t&&s.amount>0&&null==o[s.id]&&e.push(s)}},dropped:function(e,t,r,s,i,o){for(let r of this.resources)!0!==r.doIgnore&&r.resourceType===t&&r.amount>0&&null==o[r.id]&&e.push(r)},container:function(e,t,r,s,i,o){for(let r of this.containers)!0!==r.doIgnore&&r.store[t]>0&&null==o[r.id]&&e.push(r)},link:function(e,t,r,s,i,o){if(t===RESOURCE_ENERGY)for(let t of this.links)!0!==t.doIgnore&&t.energy>0&&t.takesTransfers&&null==o[t.id]&&e.push(t)},storage:function(e,t,r,s,i,o){if(null!=this.storage&&!0!==this.storage.doIgnore&&this.storage.store[t]>0&&null==o[this.storage.id]){let s=this.budget.savings[t];null!=s&&this.storage.store[t]-r>=s&&e.push(this.storage)}},extension:function(e,t,r,s,i,o){if(t===RESOURCE_ENERGY)for(let t of this.extensions)!0!==t.doIgnore&&t.energy>0&&null==o[t.id]&&e.push(t)},spawn:function(e,t,r,s,i,o){if(t===RESOURCE_ENERGY)for(let t of this.mySpawns)!0!==t.doIgnore&&t.energy>0&&null==o[t.id]&&e.push(t)},tower:function(e,t,r,s,i,o){if(t===RESOURCE_ENERGY)for(let t of this.towers)!0!==t.doIgnore&&t.energy>0&&null==o[t.id]&&e.push(t)}};t.SporeColony=class{constructor(){this.pathFinder=new m.SporePathFinder,this.tasks=[],this.tasksById={},this.spawnRequests=[],this.requestsCurrentlySpawning=[],this.cpuSpentPathing=0,this.pathingCpuLimit=30}get myRooms(){return s.Remember.byName("colony","myRooms",function(){let e=[];for(let t in Game.rooms){let r=Game.rooms[t];r.my&&e.push(r)}return e.sort(function(e,t){return e.priority<t.priority?1:e.priority>t.priority?-1:e.name<t.name?1:e.name>t.name?-1:0}),e}.bind(this))}run(){this.tasks=[],this.tasksById={},this.spawnRequests.length=0,this.requestsCurrentlySpawning.length=0;let e=this.myRooms;for(let t of e)t.trackEconomy();this.collectTasks(e);let t={};for(let e in Game.creeps){let r=Game.creeps[e];if(r.spawning)continue;let i=r.spawnRequest;null!=i&&(null==i.id||0===i.id.length||null==i.replacingCreep?r.spawnRequest=null:(null!=i.task?s.Remember.forTick(`${i.task.id}.spawnedCreeps`,()=>[]).push(r.id):null!=i.replacingCreep&&null!=i.replacingCreep.task&&s.Remember.forTick(`${i.replacingCreep.task.id}.spawnedCreeps`,()=>[]).push(r.id),this.requestsCurrentlySpawning.push(r.spawnRequest.id))),null==r.spawnRequest&&(t[r.name]=r)}
//!_.isEmpty(creeps) &&
for(let e=0;e<this.tasks.length;e++){let r=this.tasks[e];this.scheduleTask(r,t)}for(let e in t){let r=t[e];null!=r&&(r.task=null,r.say("💤"))}this.spawnCreeps();let r=_.size(t);console.log("Surplus Creeps: "+r)}scheduleTask(e,t){let r=[];e.beginScheduling();let l=OK,a=0;for(let c of function*(e,t){let r=s.Remember.forTick(`${e.id}.spawnedCreeps`,()=>[]);if(null!=r)for(let e=0;e<r.length;e++){let s=Game.getObjectById(r[e]);null!=s&&null!=t[s.name]&&(yield s)}let o=s.Remember.lastTick(`${e.id}.creeps`);if(null!=o)for(let e=0;e<o.length;e++){let r=Game.getObjectById(o[e]);null!=r&&null!=t[r.name]&&(yield r)}let n=[];e.getPrioritizingConditions(n);let l=new i.PriorityQueue([{value:0,conditionIndex:0,elements:_.values(t)}],(e,t)=>t.value-e.value);for(;l.length>0;){let e=l.pop();if(n.length<=e.conditionIndex)for(let t=0;t<e.elements.length;t++)yield e.elements[t];else for(let t=0;t<e.elements.length;t++){let r=n[e.conditionIndex](e.elements[t]);if(r<0)continue;let s=r+e.value,i=e.conditionIndex+1,o=!0;for(let r=0;r<l.length;r++){let n=l.get(r);if(n.conditionIndex!==i)break;if(n.value===s){o=!1,n.elements.push(e.elements[t]);break}}o&&l.push({value:s,conditionIndex:i,elements:[e.elements[t]]})}}}(e,t)){if(l===o.ERR_NO_WORK)break;if((l=e.schedule(c))>=0||null!=c.spawnRequest&&c.spawnRequest.task==e){if(r.push(c),e.isIdeal(c)?(c.task=e,c.taskPriority=a,a++):c.task=null,t[c.name]=null,delete t[c.name],null!=c.spawnRequest&&null!=c.spawnRequest.replacingCreep?console.log(`Scheduled ${c.name} for ${null!=e.name?e.name:e.id} ${c.type} REPLACEMENT`):console.log(`Scheduled ${c.name} for ${null!=e.name?e.name:e.id} ${c.type}`),c.ticksToLive<300&&null!=n.CREEP_TYPE[c.type]&&null!=c.task&&null!=e.labor.types[c.type]&&e.shouldPlanToReplace(c)&&this.spawnRequests.push(new u.SpawnRequest(`replace_${c.name}`,null,c,n.CREEP_TYPE[c.type])),this.schedulePassives(c),l===o.NO_MORE_WORK)break}else{if(c.task==e&&(c.task=null),null!=c.spawnRequest&&c.spawnRequest.task==e&&(c.spawnRequest=null),l===o.ERR_NO_WORK)break;l===o.ERR_CANNOT_PERFORM_TASK?console.log("   "+c+" ERR_CANNOT_PERFORM_TASK "+e.id):l===o.ERR_SKIP_WORKER||console.log("UNKNOWN ERROR FROM SCHEDULING: "+e.id+" creep: "+c+" code: "+l)}}e.endScheduling(),l!==o.NO_MORE_WORK&&l!==o.ERR_NO_WORK&&this.calculateLaborPool(e,r)}calculateLaborPool(e,t){let r=new l.LaborPool;for(let s=0;s<t.length;s++){let i=t[s];null!=i.type&&null!=e.labor.types[i.type]&&r.addCreep(i)}for(let t in e.labor.types){let s=e.labor.types[t];if(null==s)continue;null==r.types[t]&&(r.types[t]=new a.LaborPoolType({},0));let i=r.types[t],o=!1;if(s.min>i.count&&(o=!0),!o)for(let e in s.parts)if(s.parts[e]>i.parts[e]){o=!0;break}o&&s.max>i.count&&this.spawnRequests.push(new u.SpawnRequest("new_: "+e.id,e,null,n.CREEP_TYPE[t]))}}schedulePassives(e){if(e.action===n.ACTION_MOVE||null==e.action){let t=e.room.lookForAt(LOOK_STRUCTURES,e.pos);if(t.length>0){for(let r of t)if(r.hits<r.hitsMax){e.repair(r);break}}else{let t=e.room.lookForAt(LOOK_CONSTRUCTION_SITES,e.pos);t.length>0&&e.build(t[0])}}}collectTasks(e){let t=[];for(let e in Game.flags){let r=Game.flags[e];t.push.apply(t,r.getTasks())}for(let r of e)t.push.apply(t,r.getTasks());this.breakdownTasks(t,this.tasks),this.sortTasks(this.tasks),console.log("total tasks: "+this.tasks.length);for(let e=0;e<this.tasks.length;e++){let t=this.tasks[e];null==t.roomName?console.log("   [global]"+t.priority+" -> "+(null!=t.name?t.name:t.id)):console.log("   ["+t.roomName+"]"+t.priority+" -> "+(null!=t.name?t.name:t.id))}}sortTasks(e){e.sort(function(e,t){if(null==e.roomName&&null!=t.roomName)return 1;if(null!=e.roomName&&null==t.roomName)return-1;if(null!=e.roomName&&null!=t.roomName){if(c.SporeRoom.getPriority(e.roomName)<c.SporeRoom.getPriority(t.roomName))return 1;if(c.SporeRoom.getPriority(e.roomName)>c.SporeRoom.getPriority(t.roomName))return-1}return e.priority<t.priority?1:e.priority>t.priority?-1:e.id<t.id?1:e.id>t.id?-1:0})}breakdownTasks(e,t){for(let r=0;r<e.length;r++){let s=e[r];if(s.isComplex){let t=s.getSteps();e.push.apply(e,t)}else null==this.tasksById[s.id]?(t.push(s),this.tasksById[s.id]=s):this.tasksById[s.id].priority!==s.priority&&(t.push(s),this.tasksById[s.id]=s)}}sortAppointments(e){e.sort(function(e,t){let r=e.spawn.pos.roomName,s=e.task;null==s&&null!=e.replacingCreep&&(s=e.replacingCreep.task);let i=t.task;if(null==i&&null!=t.replacingCreep&&(i=t.replacingCreep.task),null==s&&null!=i)return 1;if(null!=s&&null==i)return-1;if(null==s&&null==i){if(e.spawnPriority<t.spawnPriority)return 1;if(e.spawnPriority>t.spawnPriority)return-1;if(e.ticksTillRequired<t.ticksTillRequired)return-1;if(e.ticksTillRequired>t.ticksTillRequired)return 1}if(null==s.roomName&&null!=i.roomName&&i.roomName===r)return console.log(s.name+" missing room identifier"),1;if(null!=s.roomName&&s.roomName===r&&null==i.roomName)return console.log(i.name+" missing room identifier"),-1;if(s.roomName!==r&&i.roomName===r)return 1;if(s.roomName===r&&i.roomName!==r)return-1;let o=Game.rooms[s.roomName],n=Game.rooms[i.roomName];return null==o&&null!=n?1:null!=o&&null==n?-1:s.priority<i.priority?1:s.priority>i.priority?-1:e.spawnPriority<t.spawnPriority?1:e.spawnPriority>t.spawnPriority?-1:e.ticksTillRequired<t.ticksTillRequired?-1:e.ticksTillRequired>t.ticksTillRequired?1:0})}getSpawnAppointments(e,t){let r=[];for(let s in t){let i,o=t[s],n=e.task;if(null==n&&null!=e.replacingCreep&&(n=e.replacingCreep.task),null!=n){if(null==(i=n.createAppointment(o,e))||-1===i.spawnPriority){console.log("Skipping Appointment: "+e.id+" "+e.creepBody.name);continue}}else null==e.replacingCreep?i=new SpawnAppointment(e.id,null,.001,o,0,null,e.creepBody):console.log("Skipping Appointment: "+e.id+" "+e.creepBody.name);null!=i&&r.push(i)}return r}spawnCreeps(){let e={},t={},r=!1;for(let s in Game.spawns){let i=Game.spawns[s];r=!0,e[i.name]=[],t[i.name]=i}if(!r)return;for(let r of this.spawnRequests){if(-1!==this.requestsCurrentlySpawning.indexOf(r.id))continue;let s=this.getSpawnAppointments(r,t);for(let t of s)e[t.spawn.name].push(t)}let s=_.values(t);s.sort(function(e,t){return e.room.energyCapacityAvailable<t.room.energyCapacityAvailable?1:e.room.energyCapacityAvailable>t.room.energyCapacityAvailable?-1:e.room.name<t.room.name?1:e.room.name>t.room.name?-1:0});for(let t of s){if(0===e[t.name].length)continue;this.sortAppointments(e[t.name]);for(let r of e[t.name])console.log("Appointment: "+r.id+" "+r.creepBody.name+" "+r.ticksTillRequired);let r=null,s=null,i=null;for(let o=0;o<e[t.name].length;o++){let n=e[t.name][o],l=n.spawn.getBody(n.creepBody),a=l.length*CREEP_SPAWN_TIME;(null==r||n.ticksTillRequired+a<r.ticksTillRequired-10)&&(r=n,s=l,i=a)}null!=r&&r.ticksTillRequired<=0&&this.spawnCreep(r)}}spawnCreep(e){let t=e.spawn,r=e.creepBody;if(console.log("spawnCreep: "),null!=t.spawning)return;let s=t.getBody(r),i=`${t.room.name}-${r.name}-${Game.time}`,o=null!=e.task?e.task.id:null,n=null!=e.replacingCreep?e.replacingCreep.name:null;const l={memory:{type:r.name,spawnRequest:{id:e.id,taskId:o,replacingCreepName:n}},dryRun:!0};let a=t.spawnCreep(s,i,l);a===OK?(l.dryRun=!1,t.spawnCreep(s,i,l)):console.log("ERROR: spawnCreep():"+a+" body: "+s.toString())}recycleCreeps(e,t){let r=_.size(e);if(console.log("Surplus Creeps: "+r),r>6){let r=_.groupBy(e,function(e){return e.room.name});for(let e of t){let t=r[e.name];if(null!=t&&t.length>6&&e.mySpawns.length>0){let r=new p.RecycleCreep(h.Ptr.from(e.mySpawns[0]));t.sort(function(e,t){return e.body.length<t.body.length?1:e.body.length>t.body.length?-1:0});for(let e=0;e<t.length-6;e++){let s=t[e];r.schedule(s)===ERR_NO_BODYPART&&s.suicide()}}}}}claimResource(e,t,r,s,i,o,n,l,a){if(null!=a&&null!=a.target&&null==l[a.target.id]){let o=_.flattenDeep(n.storePriorities);if(_.includes(o,a.type)||_.includes(o,a.target.id)){let o=a.target.makeClaim(e,t,r,s,i);if(null!==o)return o}}null!=n.roomNames&&0!==n.roomNames.length||(n.roomNames=[],n.roomNames.push(e.pos.roomName));let u=o;null!=o.pos&&(u=o.pos);for(let o=0;o<n.storePriorities.length;o++){let a=n.storePriorities[o],c=[];for(let s=0;s<a.length;s++)for(let i of n.roomNames)null!=Game.rooms[i]&&d[a[s]].bind(Game.rooms[i])(c,t,r,e,u,l);if(c.length>0){u.sortByRangeTo(c);for(let o of c){if(null==o.makeClaim)continue;let n=o.makeClaim(e,t,r,s,i);if(null!=n)return n}}}return null}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){if(this.data=e,this.data=e||[],this.length=this.data.length,this.compare=t||s.defaultCompare,null!=e)for(let e=Math.floor(this.length/2);e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){let e=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),e}peek(){return this.data[0]}get(e){return this.data[e]}_up(e){let t=this.data,r=this.compare;for(;e>0;){let i=Math.floor((e-1)/2);if(!(r(t[e],t[i])<0))break;s.swap(t,i,e),e=i}}_down(e){let t=this.data,r=this.compare,i=this.length;for(;;){let o=2*e+1,n=o+1,l=e;if(o<i&&r(t[o],t[l])<0&&(l=o),n<i&&r(t[n],t[l])<0&&(l=n),l===e)return;s.swap(t,l,e),e=l}}static defaultCompare(e,t){return e<t?-1:e>t?1:0}static swap(e,t,r){let s=e[t];e[t]=e[r],e[r]=s}}t.PriorityQueue=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(26);t.LaborPool=class{constructor(){this.types={}}addCreep(e){if(null!=e.type){null==this.types[e.type]&&(this.types[e.type]=new s.LaborPoolType({},0)),this.types[e.type].count++;for(let t of e.body)t.hits>0&&this.types[e.type].parts[t.type]++}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCRIPT_VERSION=0,t.SCRIPT_VERSION=1561432871223},function(e,t,r){"use strict";let s=0,i=!1,o=0;function n(){this.name="AlreadyWrappedError",this.message="Error attempted to double wrap a function.",this.stack=(new Error).stack}function l(){o=0,Game.profiler={stream(e,t){a("stream",e||10,t)},email(e,t){a("email",e||100,t)},profile(e,t){a("profile",e||100,t)},background(e){a("background",!1,e)},restart(){if(d.isProfiling()){const e=Memory.profiler.filter;let t=!1;Memory.profiler.disableTick&&(t=Memory.profiler.disableTick-Memory.profiler.enabledTick+1),a(Memory.profiler.type,t,e)}},reset:u,output:d.output},Game.rooms.sim&&(s=0,Game.cpu.getUsed=function(){return performance.now()-s})}function a(e,t,r){u();const s=!!Number.isInteger(t)&&Game.time+t;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:s,type:e,filter:r})}function u(){Memory.profiler=null}function c(){return Memory.profiler.filter}const h=["getUsed","constructor"];function p(e,t){const r=e.prototype?e.prototype:e;return Object.getOwnPropertyNames(r).forEach(e=>{const s=`${t}.${e}`;if(-1!==h.indexOf(e))return;const i=Object.getOwnPropertyDescriptor(r,e);if(!i)return;if(i.get||i.set){if(!i.configurable)return;const t={};if(i.get){const e=`${s}:get`;t.get=m(i.get,e)}if(i.set){const e=`${s}:set`;t.set=m(i.set,e)}return void Object.defineProperty(r,e,t)}if(!("function"==typeof i.value))return;const o=r[e];r[e]=m(o,s)}),r}function m(e,t){const r=t||e.name;return r?function(e,t){if(t.profilerWrapped)throw new n;function r(){if(d.isProfiling()){const r=e===c(),s=Game.cpu.getUsed();r&&o++;const i=t.apply(this,arguments);if(o>0||!c()){const t=Game.cpu.getUsed();d.record(e,t-s)}return r&&o--,i}return t.apply(this,arguments)}return r.profilerWrapped=!0,r.toString=()=>`_/ screeps-profiler wrapped function:\n${t.toString()}`,r}(r,e):(console.log("Couldn't find a function name for - ",e),console.log("Will not profile this function."),e)}const d={printProfile(){console.log(d.output())},emailProfile(){Game.notify(d.output(1e3))},output(e){const t=e||1e3;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";const r=Math.min(Memory.profiler.disableTick||Game.time,Game.time)-(Memory.profiler.enabledTick+1),s="calls\t\ttime\t\tavg\t\tfunction",i=[`Avg: ${(Memory.profiler.totalTime/r).toFixed(2)}`,`Total: ${Memory.profiler.totalTime.toFixed(2)}`,`Ticks: ${r}`].join("\t"),o=[s];let n=s.length+1+i.length;const l=d.lines();let a=!1;for(;!a&&l.length;){const e=l.shift();n+e.length+1<t?(o.push(e),n+=e.length+1):a=!0}return o.push(i),o.join("\n")},lines:()=>Object.keys(Memory.profiler.map).map(e=>{const t=Memory.profiler.map[e];return{name:e,calls:t.calls,totalTime:t.time,averageTime:t.time/t.calls}}).sort((e,t)=>t.totalTime-e.totalTime).map(e=>[e.calls,e.totalTime.toFixed(1),e.averageTime.toFixed(3),e.name].join("\t\t")),prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},{name:"Spawn",val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},{name:"Source",val:Source},{name:"Flag",val:Flag}],record(e,t){Memory.profiler.map[e]||(Memory.profiler.map[e]={time:0,calls:0}),Memory.profiler.map[e].calls++,Memory.profiler.map[e].time+=t},endTick(){if(Game.time>=Memory.profiler.enabledTick){const e=Game.cpu.getUsed();Memory.profiler.totalTime+=e,d.report()}},report(){d.shouldPrint()?d.printProfile():d.shouldEmail()&&d.emailProfile()},isProfiling:()=>!(!i||!Memory.profiler)&&(!Memory.profiler.disableTick||Game.time<=Memory.profiler.disableTick),type:()=>Memory.profiler.type,shouldPrint(){const e="stream"===d.type(),t="profile"===d.type(),r=Memory.profiler.disableTick===Game.time;return e||t&&r},shouldEmail:()=>"email"===d.type()&&Memory.profiler.disableTick===Game.time};e.exports={wrap(e){if(i&&l(),d.isProfiling()){s=Game.cpu.getUsed();const t=e();return d.endTick(),t}return e()},enable(){i=!0,d.prototypes.forEach(e=>{p(e.val,e.name)})},output:d.output,registerObject:p,registerFN:m,registerClass:p}}]);